var Us=Object.defineProperty,Vs=Object.defineProperties;var qs=Object.getOwnPropertyDescriptors;var Ye=Object.getOwnPropertySymbols;var It=Object.prototype.hasOwnProperty,Pt=Object.prototype.propertyIsEnumerable;var xt=(t,e,s)=>e in t?Us(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,fe=(t,e)=>{for(var s in e||(e={}))It.call(e,s)&&xt(t,s,e[s]);if(Ye)for(var s of Ye(e))Pt.call(e,s)&&xt(t,s,e[s]);return t},Ce=(t,e)=>Vs(t,qs(e));var $t=(t,e)=>{var s={};for(var i in t)It.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(t!=null&&Ye)for(var i of Ye(t))e.indexOf(i)<0&&Pt.call(t,i)&&(s[i]=t[i]);return s};import{S as bt,i as yt,s as vt,e as E,t as q,k as H,c as C,a as O,h as z,d as y,m as J,b as A,g as Y,J as u,K as ue,L as ae,M as gs,j as ht,N as ye,O as wt,E as ve,P as _s,Q as He,R as bs,T as Bt,U as zs,V as Fs,W as js,l as Dt,q as et,o as tt,X as Hs,Y as Js,w as Mt,x as Ut,y as Vt,Z as Ws,B as qt,_ as zt}from"../chunks/index-5f22287f.js";import{w as We}from"../chunks/index-b82fac14.js";var Ft=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Gs(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(s){var i=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,i.get?i:{enumerable:!0,get:function(){return t[s]}})}),e}var ys={exports:{}},Ks={},Ys=Object.freeze(Object.defineProperty({__proto__:null,default:Ks},Symbol.toStringTag,{value:"Module"})),ut=Gs(Ys),Ve={exports:{}};const Xs=/^\u0001ACTION ([^\u0001]+)\u0001$/,Qs=/^(justinfan)(\d+$)/,Zs=/\\([sn:r\\])/g,ei=/([ \n;\r\\])/g,jt={s:" ",n:"",":":";",r:""},Ht={" ":"s","\n":"n",";":":","\r":"r"},ti=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i"),si=/[|\\^$*+?:#]/,Xe=Ve.exports={get:(t,e)=>typeof t=="undefined"?e:t,hasOwn:(t,e)=>({}).hasOwnProperty.call(t,e),promiseDelay:t=>new Promise(e=>setTimeout(e,t)),isFinite:t=>isFinite(t)&&!isNaN(parseFloat(t)),toNumber(t,e){if(t===null)return 0;const s=Math.pow(10,Xe.isFinite(e)?e:0);return Math.round(t*s)/s},isInteger:t=>!isNaN(Xe.toNumber(t,0)),isRegex:t=>si.test(t),isURL:t=>ti.test(t),justinfan:()=>`justinfan${Math.floor(Math.random()*8e4+1e3)}`,isJustinfan:t=>Qs.test(t),channel(t){const e=(t||"").toLowerCase();return e[0]==="#"?e:"#"+e},username(t){const e=(t||"").toLowerCase();return e[0]==="#"?e.slice(1):e},token:t=>t?t.toLowerCase().replace("oauth:",""):"",password(t){const e=Xe.token(t);return e?`oauth:${e}`:""},actionMessage:t=>t.match(Xs),replaceAll(t,e){if(t===null||typeof t=="undefined")return null;for(const s in e)t=t.replace(new RegExp(s,"g"),e[s]);return t},unescapeHtml:t=>t.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'"),unescapeIRC(t){return!t||typeof t!="string"||!t.includes("\\")?t:t.replace(Zs,(e,s)=>s in jt?jt[s]:s)},escapeIRC(t){return!t||typeof t!="string"?t:t.replace(ei,(e,s)=>s in Ht?`\\${Ht[s]}`:s)},addWord:(t,e)=>t.length?t+" "+e:t+e,splitLine(t,e){let s=t.substring(0,e).lastIndexOf(" ");return s===-1&&(s=e-1),[t.substring(0,s),t.substring(s+1)]},extractNumber(t){const e=t.split(" ");for(let s=0;s<e.length;s++)if(Xe.isInteger(e[s]))return~~e[s];return 0},formatDate(t){let e=t.getHours(),s=t.getMinutes();return e=(e<10?"0":"")+e,s=(s<10?"0":"")+s,`${e}:${s}`},inherits(t,e){t.super_=e;const s=function(){};s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t},isNode(){try{return typeof process=="object"&&Object.prototype.toString.call(process)==="[object process]"}catch{}return!1}},ii=ut,Jt=Ve.exports;var ni=function(e,s){let i=e.url!==void 0?e.url:e.uri;if(Jt.isURL(i)||(i=`https://api.twitch.tv/kraken${i[0]==="/"?i:`/${i}`}`),Jt.isNode()){const n=Object.assign({method:"GET",json:!0},e);n.qs&&(i+=`?${new URLSearchParams(n.qs)}`);const o={};"fetchAgent"in this.opts.connection&&(o.agent=this.opts.connection.fetchAgent);const l=ii(i,Ce(fe({},o),{method:n.method,headers:n.headers,body:n.body}));let p={};l.then(h=>(p={statusCode:h.status,headers:h.headers},n.json?h.json():h.text())).then(h=>s(null,p,h),h=>s(h,p,null))}else{const n=Object.assign({method:"GET",headers:{}},e,{url:i}),o=new XMLHttpRequest;o.open(n.method,n.url,!0);for(const l in n.headers)o.setRequestHeader(l,n.headers[l]);o.responseType="json",o.addEventListener("load",l=>{o.readyState===4&&(o.status!==200?s(o.status,null,null):s(null,null,o.response))}),o.send()}};const R=Ve.exports;function Wt(t,e){return t=R.channel(t),e=R.get(e,30),this._sendCommand(null,t,`/followers ${e}`,(s,i)=>{this.once("_promiseFollowers",n=>{n?i(n):s([t,~~e])})})}function Gt(t){return t=R.channel(t),this._sendCommand(null,t,"/followersoff",(e,s)=>{this.once("_promiseFollowersoff",i=>{i?s(i):e([t])})})}function Kt(t){return t=R.channel(t),this._sendCommand(null,null,`PART ${t}`,(e,s)=>{this.once("_promisePart",i=>{i?s(i):e([t])})})}function Yt(t){return t=R.channel(t),this._sendCommand(null,t,"/r9kbeta",(e,s)=>{this.once("_promiseR9kbeta",i=>{i?s(i):e([t])})})}function Xt(t){return t=R.channel(t),this._sendCommand(null,t,"/r9kbetaoff",(e,s)=>{this.once("_promiseR9kbetaoff",i=>{i?s(i):e([t])})})}function Qt(t,e){return t=R.channel(t),e=R.get(e,300),this._sendCommand(null,t,`/slow ${e}`,(s,i)=>{this.once("_promiseSlow",n=>{n?i(n):s([t,~~e])})})}function Zt(t){return t=R.channel(t),this._sendCommand(null,t,"/slowoff",(e,s)=>{this.once("_promiseSlowoff",i=>{i?s(i):e([t])})})}var oi={action(t,e){return t=R.channel(t),e=`ACTION ${e}`,this._sendMessage(this._getPromiseDelay(),t,e,(s,i)=>{s([t,e])})},ban(t,e,s){return t=R.channel(t),e=R.username(e),s=R.get(s,""),this._sendCommand(null,t,`/ban ${e} ${s}`,(i,n)=>{this.once("_promiseBan",o=>{o?n(o):i([t,e,s])})})},clear(t){return t=R.channel(t),this._sendCommand(null,t,"/clear",(e,s)=>{this.once("_promiseClear",i=>{i?s(i):e([t])})})},color(t,e){return e=R.get(e,t),this._sendCommand(null,"#tmijs",`/color ${e}`,(s,i)=>{this.once("_promiseColor",n=>{n?i(n):s([e])})})},commercial(t,e){return t=R.channel(t),e=R.get(e,30),this._sendCommand(null,t,`/commercial ${e}`,(s,i)=>{this.once("_promiseCommercial",n=>{n?i(n):s([t,~~e])})})},deletemessage(t,e){return t=R.channel(t),this._sendCommand(null,t,`/delete ${e}`,(s,i)=>{this.once("_promiseDeletemessage",n=>{n?i(n):s([t])})})},emoteonly(t){return t=R.channel(t),this._sendCommand(null,t,"/emoteonly",(e,s)=>{this.once("_promiseEmoteonly",i=>{i?s(i):e([t])})})},emoteonlyoff(t){return t=R.channel(t),this._sendCommand(null,t,"/emoteonlyoff",(e,s)=>{this.once("_promiseEmoteonlyoff",i=>{i?s(i):e([t])})})},followersonly:Wt,followersmode:Wt,followersonlyoff:Gt,followersmodeoff:Gt,host(t,e){return t=R.channel(t),e=R.username(e),this._sendCommand(2e3,t,`/host ${e}`,(s,i)=>{this.once("_promiseHost",(n,o)=>{n?i(n):s([t,e,~~o])})})},join(t){return t=R.channel(t),this._sendCommand(void 0,null,`JOIN ${t}`,(e,s)=>{const i="_promiseJoin";let n=!1;const o=(p,h)=>{t===R.channel(h)&&(this.removeListener(i,o),n=!0,p?s(p):e([t]))};this.on(i,o);const l=this._getPromiseDelay();R.promiseDelay(l).then(()=>{n||this.emit(i,"No response from Twitch.",t)})})},mod(t,e){return t=R.channel(t),e=R.username(e),this._sendCommand(null,t,`/mod ${e}`,(s,i)=>{this.once("_promiseMod",n=>{n?i(n):s([t,e])})})},mods(t){return t=R.channel(t),this._sendCommand(null,t,"/mods",(e,s)=>{this.once("_promiseMods",(i,n)=>{i?s(i):(n.forEach(o=>{this.moderators[t]||(this.moderators[t]=[]),this.moderators[t].includes(o)||this.moderators[t].push(o)}),e(n))})})},part:Kt,leave:Kt,ping(){return this._sendCommand(null,null,"PING",(t,e)=>{this.latency=new Date,this.pingTimeout=setTimeout(()=>{this.ws!==null&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout))},R.get(this.opts.connection.timeout,9999)),this.once("_promisePing",s=>t([parseFloat(s)]))})},r9kbeta:Yt,r9kmode:Yt,r9kbetaoff:Xt,r9kmodeoff:Xt,raw(t){return this._sendCommand(null,null,t,(e,s)=>{e([t])})},say(t,e){return t=R.channel(t),e.startsWith(".")&&!e.startsWith("..")||e.startsWith("/")||e.startsWith("\\")?e.substr(1,3)==="me "?this.action(t,e.substr(4)):this._sendCommand(null,t,e,(s,i)=>{s([t,e])}):this._sendMessage(this._getPromiseDelay(),t,e,(s,i)=>{s([t,e])})},slow:Qt,slowmode:Qt,slowoff:Zt,slowmodeoff:Zt,subscribers(t){return t=R.channel(t),this._sendCommand(null,t,"/subscribers",(e,s)=>{this.once("_promiseSubscribers",i=>{i?s(i):e([t])})})},subscribersoff(t){return t=R.channel(t),this._sendCommand(null,t,"/subscribersoff",(e,s)=>{this.once("_promiseSubscribersoff",i=>{i?s(i):e([t])})})},timeout(t,e,s,i){return t=R.channel(t),e=R.username(e),s!==null&&!R.isInteger(s)&&(i=s,s=300),s=R.get(s,300),i=R.get(i,""),this._sendCommand(null,t,`/timeout ${e} ${s} ${i}`,(n,o)=>{this.once("_promiseTimeout",l=>{l?o(l):n([t,e,~~s,i])})})},unban(t,e){return t=R.channel(t),e=R.username(e),this._sendCommand(null,t,`/unban ${e}`,(s,i)=>{this.once("_promiseUnban",n=>{n?i(n):s([t,e])})})},unhost(t){return t=R.channel(t),this._sendCommand(2e3,t,"/unhost",(e,s)=>{this.once("_promiseUnhost",i=>{i?s(i):e([t])})})},unmod(t,e){return t=R.channel(t),e=R.username(e),this._sendCommand(null,t,`/unmod ${e}`,(s,i)=>{this.once("_promiseUnmod",n=>{n?i(n):s([t,e])})})},unvip(t,e){return t=R.channel(t),e=R.username(e),this._sendCommand(null,t,`/unvip ${e}`,(s,i)=>{this.once("_promiseUnvip",n=>{n?i(n):s([t,e])})})},vip(t,e){return t=R.channel(t),e=R.username(e),this._sendCommand(null,t,`/vip ${e}`,(s,i)=>{this.once("_promiseVip",n=>{n?i(n):s([t,e])})})},vips(t){return t=R.channel(t),this._sendCommand(null,t,"/vips",(e,s)=>{this.once("_promiseVips",(i,n)=>{i?s(i):e(n)})})},whisper(t,e){return t=R.username(t),t===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(null,"#tmijs",`/w ${t} ${e}`,(s,i)=>{this.once("_promiseWhisper",n=>{n&&i(n)})}).catch(s=>{if(s&&typeof s=="string"&&s.indexOf("No response from Twitch.")!==0)throw s;const i=R.channel(t),n=Object.assign({"message-type":"whisper","message-id":null,"thread-id":null,username:this.getUsername()},this.globaluserstate);return this.emits(["whisper","message"],[[i,n,e,!0],[i,n,e,!0]]),[t,e]})}};function ce(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var ri=ce;ce.EventEmitter=ce;ce.prototype._events=void 0;ce.prototype._maxListeners=void 0;ce.defaultMaxListeners=10;ce.prototype.setMaxListeners=function(t){if(!ai(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this};ce.prototype.emit=function(t){var e,s,i,n,o,l;if(this._events||(this._events={}),t==="error"&&(!this._events.error||Je(this._events.error)&&!this._events.error.length))throw e=arguments[1],e instanceof Error?e:TypeError('Uncaught, unspecified "error" event.');if(s=this._events[t],vs(s))return!1;if(Te(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),s.apply(this,n)}else if(Je(s))for(n=Array.prototype.slice.call(arguments,1),l=s.slice(),i=l.length,o=0;o<i;o++)l[o].apply(this,n);return!0};ce.prototype.addListener=function(t,e){var s;if(!Te(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,Te(e.listener)?e.listener:e),this._events[t]?Je(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,Je(this._events[t])&&!this._events[t].warned&&(vs(this._maxListeners)?s=ce.defaultMaxListeners:s=this._maxListeners,s&&s>0&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),typeof console.trace=="function"&&console.trace())),this};ce.prototype.on=ce.prototype.addListener;ce.prototype.once=function(t,e){if(!Te(e))throw TypeError("listener must be a function");var s=!1;if(this._events.hasOwnProperty(t)&&t.charAt(0)==="_"){var i=1,n=t;for(var o in this._events)this._events.hasOwnProperty(o)&&o.startsWith(n)&&i++;t=t+i}function l(){t.charAt(0)==="_"&&!isNaN(t.substr(t.length-1))&&(t=t.substring(0,t.length-1)),this.removeListener(t,l),s||(s=!0,e.apply(this,arguments))}return l.listener=e,this.on(t,l),this};ce.prototype.removeListener=function(t,e){var s,i,n,o;if(!Te(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=this._events[t],n=s.length,i=-1,s===e||Te(s.listener)&&s.listener===e){if(delete this._events[t],this._events.hasOwnProperty(t+"2")&&t.charAt(0)==="_"){var l=t;for(var p in this._events)this._events.hasOwnProperty(p)&&p.startsWith(l)&&(isNaN(parseInt(p.substr(p.length-1)))||(this._events[t+parseInt(p.substr(p.length-1)-1)]=this._events[p],delete this._events[p]));this._events[t]=this._events[t+"1"],delete this._events[t+"1"]}this._events.removeListener&&this.emit("removeListener",t,e)}else if(Je(s)){for(o=n;o-- >0;)if(s[o]===e||s[o].listener&&s[o].listener===e){i=o;break}if(i<0)return this;s.length===1?(s.length=0,delete this._events[t]):s.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this};ce.prototype.removeAllListeners=function(t){var e,s;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[t]&&delete this._events[t],this;if(arguments.length===0){for(e in this._events)e!=="removeListener"&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[t],Te(s))this.removeListener(t,s);else if(s)for(;s.length;)this.removeListener(t,s[s.length-1]);return delete this._events[t],this};ce.prototype.listeners=function(t){var e;return!this._events||!this._events[t]?e=[]:Te(this._events[t])?e=[this._events[t]]:e=this._events[t].slice(),e};ce.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(Te(e))return 1;if(e)return e.length}return 0};ce.listenerCount=function(t,e){return t.listenerCount(e)};function Te(t){return typeof t=="function"}function ai(t){return typeof t=="number"}function Je(t){return typeof t=="object"&&t!==null}function vs(t){return t===void 0}const ci=Ve.exports;let ws="info";const es={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function $e(t){return function(e){es[t]>=es[ws]&&console.log(`[${ci.formatDate(new Date)}] ${t}: ${e}`)}}var li={setLevel(t){ws=t},trace:$e("trace"),debug:$e("debug"),info:$e("info"),warn:$e("warn"),error:$e("error"),fatal:$e("fatal")};const at=Ve.exports,Be=/\S+/g;function ct(t,e,s=",",i="/",n){const o=t[e];if(o===void 0)return t;const l=typeof o=="string";if(t[e+"-raw"]=l?o:null,o===!0)return t[e]=null,t;if(t[e]={},l){const p=o.split(s);for(let h=0;h<p.length;h++){const g=p[h].split(i);let c=g[1];n!==void 0&&c&&(c=c.split(n)),t[e][g[0]]=c||null}}return t}var hi={badges:t=>ct(t,"badges"),badgeInfo:t=>ct(t,"badge-info"),emotes:t=>ct(t,"emotes","/",":",","),emoteRegex(t,e,s,i){Be.lastIndex=0;const n=new RegExp("(\\b|^|\\s)"+at.unescapeHtml(e)+"(\\b|$|\\s)");let o;for(;(o=Be.exec(t))!==null;)n.test(o[0])&&(i[s]=i[s]||[],i[s].push([o.index,Be.lastIndex-1]))},emoteString(t,e,s,i){Be.lastIndex=0;let n;for(;(n=Be.exec(t))!==null;)n[0]===at.unescapeHtml(e)&&(i[s]=i[s]||[],i[s].push([n.index,Be.lastIndex-1]))},transformEmotes(t){let e="";return Object.keys(t).forEach(s=>{e=`${e+s}:`,t[s].forEach(i=>e=`${e+i.join("-")},`),e=`${e.slice(0,-1)}/`}),e.slice(0,-1)},formTags(t){const e=[];for(const s in t){const i=at.escapeIRC(t[s]);e.push(`${s}=${i}`)}return`@${e.join(";")}`},msg(t){const e={raw:t,tags:{},prefix:null,command:null,params:[]};let s=0,i=0;if(t.charCodeAt(0)===64){if(i=t.indexOf(" "),i===-1)return null;const n=t.slice(1,i).split(";");for(let o=0;o<n.length;o++){const l=n[o],p=l.split("=");e.tags[p[0]]=l.substring(l.indexOf("=")+1)||!0}s=i+1}for(;t.charCodeAt(s)===32;)s++;if(t.charCodeAt(s)===58){if(i=t.indexOf(" ",s),i===-1)return null;for(e.prefix=t.slice(s+1,i),s=i+1;t.charCodeAt(s)===32;)s++}if(i=t.indexOf(" ",s),i===-1)return t.length>s?(e.command=t.slice(s),e):null;for(e.command=t.slice(s,i),s=i+1;t.charCodeAt(s)===32;)s++;for(;s<t.length;){if(i=t.indexOf(" ",s),t.charCodeAt(s)===58){e.params.push(t.slice(s+1));break}if(i!==-1){for(e.params.push(t.slice(s,i)),s=i+1;t.charCodeAt(s)===32;)s++;continue}if(i===-1){e.params.push(t.slice(s));break}}return e}};class ui{constructor(e){this.queue=[],this.index=0,this.defaultDelay=e===void 0?3e3:e}add(e,s){this.queue.push({fn:e,delay:s})}next(){const e=this.index++,s=this.queue[e];if(!s)return;const i=this.queue[this.index];if(s.fn(),i){const n=i.delay===void 0?this.defaultDelay:i.delay;setTimeout(()=>this.next(),n)}}}var fi=ui;(function(t){const e=typeof Ft!="undefined"?Ft:typeof window!="undefined"?window:{},s=e.WebSocket||ut,i=e.fetch||ut,n=ni,o=oi,l=ri.EventEmitter,p=li,h=hi,g=fi,c=Ve.exports;let _=!1;const d=function w(r){if(!(this instanceof w))return new w(r);this.opts=c.get(r,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=c.get(this.opts.options.clientId,null),this._globalDefaultChannel=c.channel(c.get(this.opts.options.globalDefaultChannel,"#tmijs")),this._skipMembership=c.get(this.opts.options.skipMembership,!1),this._skipUpdatingEmotesets=c.get(this.opts.options.skipUpdatingEmotesets,!1),this._updateEmotesetsTimer=null,this._updateEmotesetsTimerDelay=c.get(this.opts.options.updateEmotesetsTimer,6e4),this.maxReconnectAttempts=c.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=c.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=c.get(this.opts.connection.reconnect,!0),this.reconnectDecay=c.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=c.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=c.get(this.opts.connection.secure,!this.opts.connection.server&&!this.opts.connection.port),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null;let a="error";this.opts.options.debug&&(a="info"),this.log=this.opts.logger||p;try{p.setLevel(a)}catch{}this.opts.channels.forEach((f,T,b)=>b[T]=c.channel(f)),l.call(this),this.setMaxListeners(0)};c.inherits(d,l);for(const w in o)d.prototype[w]=o[w];d.prototype.emits=function(r,a){for(let f=0;f<r.length;f++){const T=f<a.length?a[f]:a[a.length-1];this.emit.apply(this,[r[f]].concat(T))}},d.prototype.api=function(...w){_||(this.log.warn("Client.prototype.api is deprecated and will be removed for version 2.0.0"),_=!0),n(...w)},d.prototype.handleMessage=function(r){if(!r)return;this.listenerCount("raw_message")&&this.emit("raw_message",JSON.parse(JSON.stringify(r)),r);const a=c.channel(c.get(r.params[0],null));let f=c.get(r.params[1],null);const T=c.get(r.tags["msg-id"],null),b=r.tags=h.badges(h.badgeInfo(h.emotes(r.tags)));for(const m in b){if(m==="emote-sets"||m==="ban-duration"||m==="bits")continue;let v=b[m];typeof v=="boolean"?v=null:v==="1"?v=!0:v==="0"?v=!1:typeof v=="string"&&(v=c.unescapeIRC(v)),b[m]=v}if(r.prefix===null)switch(r.command){case"PING":this.emit("ping"),this._isConnected()&&this.ws.send("PONG");break;case"PONG":{const m=new Date;this.currentLatency=(m.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break}default:this.log.warn(`Could not parse message with no prefix:
${JSON.stringify(r,null,4)}`);break}else if(r.prefix==="tmi.twitch.tv")switch(r.command){case"002":case"003":case"004":case"372":case"375":case"CAP":break;case"001":this.username=r.params[0];break;case"376":{this.log.info("Connected to server."),this.userstate[this._globalDefaultChannel]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval(()=>{this._isConnected()&&this.ws.send("PING"),this.latency=new Date,this.pingTimeout=setTimeout(()=>{this.ws!==null&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer))},c.get(this.opts.connection.timeout,9999))},6e4);let m=c.get(this.opts.options.joinInterval,2e3);m<300&&(m=300);const v=new g(m),D=[...new Set([...this.opts.channels,...this.channels])];this.channels=[];for(let x=0;x<D.length;x++){const I=D[x];v.add(()=>{this._isConnected()&&this.join(I).catch(F=>this.log.error(F))})}v.next();break}case"NOTICE":{const m=[null],v=[a,T,f],D=[T],x=[a,!0],I=[a,!1],F=[v,m],P=[v,D],L=`[${a}] ${f}`;switch(T){case"subs_on":this.log.info(`[${a}] This room is now in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribers"],[x,x,m]);break;case"subs_off":this.log.info(`[${a}] This room is no longer in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[I,I,m]);break;case"emote_only_on":this.log.info(`[${a}] This room is now in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonly"],[x,m]);break;case"emote_only_off":this.log.info(`[${a}] This room is no longer in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonlyoff"],[I,m]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":break;case"r9k_on":this.log.info(`[${a}] This room is now in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[x,x,m]);break;case"r9k_off":this.log.info(`[${a}] This room is no longer in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[I,I,m]);break;case"room_mods":{const $=f.split(": "),M=($.length>1?$[1]:"").toLowerCase().split(", ").filter(k=>k);this.emits(["_promiseMods","mods"],[[null,M],[a,M]]);break}case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[a,[]]]);break;case"vips_success":{f.endsWith(".")&&(f=f.slice(0,-1));const $=f.split(": "),M=($.length>1?$[1]:"").toLowerCase().split(", ").filter(k=>k);this.emits(["_promiseVips","vips"],[[null,M],[a,M]]);break}case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[a,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_anon":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(L),this.emits(["notice","_promiseBan"],P);break;case"ban_success":this.log.info(L),this.emits(["notice","_promiseBan"],F);break;case"usage_clear":this.log.info(L),this.emits(["notice","_promiseClear"],P);break;case"usage_mods":this.log.info(L),this.emits(["notice","_promiseMods"],[v,[T,[]]]);break;case"mod_success":this.log.info(L),this.emits(["notice","_promiseMod"],F);break;case"usage_vips":this.log.info(L),this.emits(["notice","_promiseVips"],[v,[T,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":case"bad_vip_max_vips_reached":case"bad_vip_achievement_incomplete":this.log.info(L),this.emits(["notice","_promiseVip"],[v,[T,[]]]);break;case"vip_success":this.log.info(L),this.emits(["notice","_promiseVip"],F);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(L),this.emits(["notice","_promiseMod"],P);break;case"unmod_success":this.log.info(L),this.emits(["notice","_promiseUnmod"],F);break;case"unvip_success":this.log.info(L),this.emits(["notice","_promiseUnvip"],F);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(L),this.emits(["notice","_promiseUnmod"],P);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(L),this.emits(["notice","_promiseUnvip"],P);break;case"color_changed":this.log.info(L),this.emits(["notice","_promiseColor"],F);break;case"usage_color":case"turbo_only_color":this.log.info(L),this.emits(["notice","_promiseColor"],P);break;case"commercial_success":this.log.info(L),this.emits(["notice","_promiseCommercial"],F);break;case"usage_commercial":case"bad_commercial_error":this.log.info(L),this.emits(["notice","_promiseCommercial"],P);break;case"hosts_remaining":{this.log.info(L);const $=isNaN(f[0])?0:parseInt(f[0]);this.emits(["notice","_promiseHost"],[v,[null,~~$]]);break}case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(L),this.emits(["notice","_promiseHost"],[v,[T,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(L),this.emits(["notice","_promiseR9kbeta"],P);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(L),this.emits(["notice","_promiseR9kbetaoff"],P);break;case"timeout_success":this.log.info(L),this.emits(["notice","_promiseTimeout"],F);break;case"delete_message_success":this.log.info(`[${a} ${f}]`),this.emits(["notice","_promiseDeletemessage"],F);break;case"already_subs_off":case"usage_subs_off":this.log.info(L),this.emits(["notice","_promiseSubscribersoff"],P);break;case"already_subs_on":case"usage_subs_on":this.log.info(L),this.emits(["notice","_promiseSubscribers"],P);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(L),this.emits(["notice","_promiseEmoteonlyoff"],P);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(L),this.emits(["notice","_promiseEmoteonly"],P);break;case"usage_slow_on":this.log.info(L),this.emits(["notice","_promiseSlow"],P);break;case"usage_slow_off":this.log.info(L),this.emits(["notice","_promiseSlowoff"],P);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_anon":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(L),this.emits(["notice","_promiseTimeout"],P);break;case"untimeout_success":case"unban_success":this.log.info(L),this.emits(["notice","_promiseUnban"],F);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(L),this.emits(["notice","_promiseUnban"],P);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(L),this.emits(["notice","_promiseDeletemessage"],P);break;case"usage_unhost":case"not_hosting":this.log.info(L),this.emits(["notice","_promiseUnhost"],P);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted":case"whisper_restricted_recipient":this.log.info(L),this.emits(["notice","_promiseWhisper"],P);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":case"invalid_user":this.log.info(L),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff","_promiseWhisper"],[v,[T,a]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(L),this.emit("automod",a,T,f);break;case"unrecognized_cmd":this.log.info(L),this.emit("notice",a,T,f);break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":case"unavailable_command":this.log.info(L),this.emit("notice",a,T,f);break;case"host_on":case"host_off":break;default:f.includes("Login unsuccessful")||f.includes("Login authentication failed")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=f,this.log.error(this.reason),this.ws.close()):f.includes("Error logging in")||f.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=f,this.log.error(this.reason),this.ws.close()):f.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):(this.log.warn(`Could not parse NOTICE from tmi.twitch.tv:
${JSON.stringify(r,null,4)}`),this.emit("notice",a,T,f));break}break}case"USERNOTICE":{const m=b["display-name"]||b.login,v=b["msg-param-sub-plan"]||"",D=c.unescapeIRC(c.get(b["msg-param-sub-plan-name"],""))||null,I={prime:v.includes("Prime"),plan:v,planName:D},F=~~(b["msg-param-streak-months"]||0),P=b["msg-param-recipient-display-name"]||b["msg-param-recipient-user-name"],L=~~b["msg-param-mass-gift-count"];switch(b["message-type"]=T,T){case"resub":this.emits(["resub","subanniversary"],[[a,m,F,f,b,I]]);break;case"sub":this.emits(["subscription","sub"],[[a,m,I,f,b]]);break;case"subgift":this.emit("subgift",a,m,F,P,I,b);break;case"anonsubgift":this.emit("anonsubgift",a,F,P,I,b);break;case"submysterygift":this.emit("submysterygift",a,m,L,I,b);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",a,L,I,b);break;case"primepaidupgrade":this.emit("primepaidupgrade",a,m,I,b);break;case"giftpaidupgrade":{const $=b["msg-param-sender-name"]||b["msg-param-sender-login"];this.emit("giftpaidupgrade",a,m,$,b);break}case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",a,m,b);break;case"raid":{const $=b["msg-param-displayName"]||b["msg-param-login"],M=+b["msg-param-viewerCount"];this.emit("raided",a,$,M,b);break}case"ritual":{const $=b["msg-param-ritual-name"];switch($){case"new_chatter":this.emit("newchatter",a,m,b,f);break;default:this.emit("ritual",$,a,m,b,f);break}break}default:this.emit("usernotice",T,a,b,f);break}break}case"HOSTTARGET":{const m=f.split(" "),v=~~m[1]||0;m[0]==="-"?(this.log.info(`[${a}] Exited host mode.`),this.emits(["unhost","_promiseUnhost"],[[a,v],[null]])):(this.log.info(`[${a}] Now hosting ${m[0]} for ${v} viewer(s).`),this.emit("hosting",a,m[0],v));break}case"CLEARCHAT":if(r.params.length>1){const m=c.get(r.tags["ban-duration"],null);m===null?(this.log.info(`[${a}] ${f} has been banned.`),this.emit("ban",a,f,null,r.tags)):(this.log.info(`[${a}] ${f} has been timed out for ${m} seconds.`),this.emit("timeout",a,f,null,~~m,r.tags))}else this.log.info(`[${a}] Chat was cleared by a moderator.`),this.emits(["clearchat","_promiseClear"],[[a],[null]]);break;case"CLEARMSG":if(r.params.length>1){const m=f,v=b.login;b["message-type"]="messagedeleted",this.log.info(`[${a}] ${v}'s message has been deleted.`),this.emit("messagedeleted",a,v,m,b)}break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info(`Disconnecting and reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.disconnect().catch(m=>this.log.error(m)),setTimeout(()=>this.connect().catch(m=>this.log.error(m)),this.reconnectTimer);break;case"USERSTATE":r.tags.username=this.username,r.tags["user-type"]==="mod"&&(this.moderators[a]||(this.moderators[a]=[]),this.moderators[a].includes(this.username)||this.moderators[a].push(this.username)),!c.isJustinfan(this.getUsername())&&!this.userstate[a]&&(this.userstate[a]=b,this.lastJoined=a,this.channels.push(a),this.log.info(`Joined ${a}`),this.emit("join",a,c.username(this.getUsername()),!0)),r.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(r.tags["emote-sets"]),this.userstate[a]=b;break;case"GLOBALUSERSTATE":this.globaluserstate=b,this.emit("globaluserstate",b),typeof r.tags["emote-sets"]!="undefined"&&this._updateEmoteset(r.tags["emote-sets"]);break;case"ROOMSTATE":if(c.channel(this.lastJoined)===a&&this.emit("_promiseJoin",null,a),r.tags.channel=a,this.emit("roomstate",a,r.tags),!c.hasOwn(r.tags,"subs-only")){if(c.hasOwn(r.tags,"slow"))if(typeof r.tags.slow=="boolean"&&!r.tags.slow){const m=[a,!1,0];this.log.info(`[${a}] This room is no longer in slow mode.`),this.emits(["slow","slowmode","_promiseSlowoff"],[m,m,[null]])}else{const m=~~r.tags.slow,v=[a,!0,m];this.log.info(`[${a}] This room is now in slow mode.`),this.emits(["slow","slowmode","_promiseSlow"],[v,v,[null]])}if(c.hasOwn(r.tags,"followers-only"))if(r.tags["followers-only"]==="-1"){const m=[a,!1,0];this.log.info(`[${a}] This room is no longer in followers-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[m,m,[null]])}else{const m=~~r.tags["followers-only"],v=[a,!0,m];this.log.info(`[${a}] This room is now in follower-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowers"],[v,v,[null]])}}break;case"SERVERCHANGE":break;default:this.log.warn(`Could not parse message from tmi.twitch.tv:
${JSON.stringify(r,null,4)}`);break}else if(r.prefix==="jtv")switch(r.command){case"MODE":f==="+o"?(this.moderators[a]||(this.moderators[a]=[]),this.moderators[a].includes(r.params[2])||this.moderators[a].push(r.params[2]),this.emit("mod",a,r.params[2])):f==="-o"&&(this.moderators[a]||(this.moderators[a]=[]),this.moderators[a].filter(m=>m!==r.params[2]),this.emit("unmod",a,r.params[2]));break;default:this.log.warn(`Could not parse message from jtv:
${JSON.stringify(r,null,4)}`);break}else switch(r.command){case"353":this.emit("names",r.params[2],r.params[3].split(" "));break;case"366":break;case"JOIN":{const m=r.prefix.split("!")[0];c.isJustinfan(this.getUsername())&&this.username===m&&(this.lastJoined=a,this.channels.push(a),this.log.info(`Joined ${a}`),this.emit("join",a,m,!0)),this.username!==m&&this.emit("join",a,m,!1);break}case"PART":{let m=!1;const v=r.prefix.split("!")[0];if(this.username===v){m=!0,this.userstate[a]&&delete this.userstate[a];let D=this.channels.indexOf(a);D!==-1&&this.channels.splice(D,1),D=this.opts.channels.indexOf(a),D!==-1&&this.opts.channels.splice(D,1),this.log.info(`Left ${a}`),this.emit("_promisePart",null)}this.emit("part",a,v,m);break}case"WHISPER":{const m=r.prefix.split("!")[0];this.log.info(`[WHISPER] <${m}>: ${f}`),c.hasOwn(r.tags,"username")||(r.tags.username=m),r.tags["message-type"]="whisper";const v=c.channel(r.tags.username);this.emits(["whisper","message"],[[v,r.tags,f,!1]]);break}case"PRIVMSG":if(r.tags.username=r.prefix.split("!")[0],r.tags.username==="jtv"){const m=c.username(f.split(" ")[0]),v=f.includes("auto");if(f.includes("hosting you for")){const D=c.extractNumber(f);this.emit("hosted",a,m,D,v)}else f.includes("hosting you")&&this.emit("hosted",a,m,0,v)}else{const m=c.get(this.opts.options.messagesLogLevel,"info"),v=c.actionMessage(f);if(r.tags["message-type"]=v?"action":"chat",f=v?v[1]:f,c.hasOwn(r.tags,"bits"))this.emit("cheer",a,r.tags,f);else{if(c.hasOwn(r.tags,"msg-id")){if(r.tags["msg-id"]==="highlighted-message"){const D=r.tags["msg-id"];this.emit("redeem",a,r.tags.username,D,r.tags,f)}else if(r.tags["msg-id"]==="skip-subs-mode-message"){const D=r.tags["msg-id"];this.emit("redeem",a,r.tags.username,D,r.tags,f)}}else if(c.hasOwn(r.tags,"custom-reward-id")){const D=r.tags["custom-reward-id"];this.emit("redeem",a,r.tags.username,D,r.tags,f)}v?(this.log[m](`[${a}] *<${r.tags.username}>: ${f}`),this.emits(["action","message"],[[a,r.tags,f,!1]])):(this.log[m](`[${a}] <${r.tags.username}>: ${f}`),this.emits(["chat","message"],[[a,r.tags,f,!1]]))}}break;default:this.log.warn(`Could not parse message:
${JSON.stringify(r,null,4)}`);break}},d.prototype.connect=function(){return new Promise((r,a)=>{this.server=c.get(this.opts.connection.server,"irc-ws.chat.twitch.tv"),this.port=c.get(this.opts.connection.port,80),this.secure&&(this.port=443),this.port===443&&(this.secure=!0),this.reconnectTimer=this.reconnectTimer*this.reconnectDecay,this.reconnectTimer>=this.maxReconnectInterval&&(this.reconnectTimer=this.maxReconnectInterval),this._openConnection(),this.once("_promiseConnect",f=>{f?a(f):r([this.server,~~this.port])})})},d.prototype._openConnection=function(){const r=`${this.secure?"wss":"ws"}://${this.server}:${this.port}/`,a={};"agent"in this.opts.connection&&(a.agent=this.opts.connection.agent),this.ws=new s(r,"irc",a),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},d.prototype._onOpen=function(){!this._isConnected()||(this.log.info(`Connecting to ${this.server} on port ${this.port}..`),this.emit("connecting",this.server,~~this.port),this.username=c.get(this.opts.identity.username,c.justinfan()),this._getToken().then(r=>{const a=c.password(r);this.log.info("Sending authentication to server.."),this.emit("logon");let f="twitch.tv/tags twitch.tv/commands";this._skipMembership||(f+=" twitch.tv/membership"),this.ws.send("CAP REQ :"+f),a?this.ws.send(`PASS ${a}`):c.isJustinfan(this.username)&&this.ws.send("PASS SCHMOOPIIE"),this.ws.send(`NICK ${this.username}`)}).catch(r=>{this.emits(["_promiseConnect","disconnected"],[[r],["Could not get a token."]])}))},d.prototype._getToken=function(){const r=this.opts.identity.password;let a;return typeof r=="function"?(a=r(),a instanceof Promise?a:Promise.resolve(a)):Promise.resolve(r)},d.prototype._onMessage=function(r){r.data.trim().split(`\r
`).forEach(f=>{const T=h.msg(f);T&&this.handleMessage(T)})},d.prototype._onError=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.reason=this.ws===null?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect().catch(r=>this.log.error(r))},this.reconnectTimer)),this.ws=null},d.prototype._onClose=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Could not connect to server. Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect().catch(r=>this.log.error(r))},this.reconnectTimer))),this.ws=null},d.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},d.prototype._sendCommand=function(r,a,f,T){return new Promise((b,m)=>{if(this._isConnected())(r===null||typeof r=="number")&&(r===null&&(r=this._getPromiseDelay()),c.promiseDelay(r).then(()=>m("No response from Twitch.")));else return m("Not connected to server.");if(a!==null){const v=c.channel(a);this.log.info(`[${v}] Executing command: ${f}`),this.ws.send(`PRIVMSG ${v} :${f}`)}else this.log.info(`Executing command: ${f}`),this.ws.send(f);typeof T=="function"?T(b,m):b()})},d.prototype._sendMessage=function(r,a,f,T){return new Promise((b,m)=>{if(this._isConnected()){if(c.isJustinfan(this.getUsername()))return m("Cannot send anonymous messages.")}else return m("Not connected to server.");const v=c.channel(a);if(this.userstate[v]||(this.userstate[v]={}),f.length>=500){const P=c.splitLine(f,500);f=P[0],setTimeout(()=>{this._sendMessage(r,a,P[1],()=>{})},350)}this.ws.send(`PRIVMSG ${v} :${f}`);const D={};Object.keys(this.emotesets).forEach(P=>this.emotesets[P].forEach(L=>(c.isRegex(L.code)?h.emoteRegex:h.emoteString)(f,L.code,L.id,D)));const x=Object.assign(this.userstate[v],h.emotes({emotes:h.transformEmotes(D)||null})),I=c.get(this.opts.options.messagesLogLevel,"info"),F=c.actionMessage(f);F?(x["message-type"]="action",this.log[I](`[${v}] *<${this.getUsername()}>: ${F[1]}`),this.emits(["action","message"],[[v,x,F[1],!0]])):(x["message-type"]="chat",this.log[I](`[${v}] <${this.getUsername()}>: ${f}`),this.emits(["chat","message"],[[v,x,f,!0]])),typeof T=="function"?T(b,m):b()})},d.prototype._updateEmoteset=function(r){let a=r!==void 0;if(a&&(r===this.emotes?a=!1:this.emotes=r),this._skipUpdatingEmotesets){a&&this.emit("emotesets",r,{});return}const f=()=>{this._updateEmotesetsTimerDelay>0&&(clearTimeout(this._updateEmotesetsTimer),this._updateEmotesetsTimer=setTimeout(()=>this._updateEmoteset(r),this._updateEmotesetsTimerDelay))};this._getToken().then(T=>{const b=`https://api.twitch.tv/kraken/chat/emoticon_images?emotesets=${r}`,m={};return"fetchAgent"in this.opts.connection&&(m.agent=this.opts.connection.fetchAgent),i(b,Ce(fe({},m),{headers:{Accept:"application/vnd.twitchtv.v5+json",Authorization:`OAuth ${c.token(T)}`,"Client-ID":this.clientId}}))}).then(T=>T.json()).then(T=>{this.emotesets=T.emoticon_sets||{},this.emit("emotesets",r,this.emotesets),f()}).catch(()=>f())},d.prototype.getUsername=function(){return this.username},d.prototype.getOptions=function(){return this.opts},d.prototype.getChannels=function(){return this.channels},d.prototype.isMod=function(r,a){const f=c.channel(r);return this.moderators[f]||(this.moderators[f]=[]),this.moderators[f].includes(c.username(a))},d.prototype.readyState=function(){return this.ws===null?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},d.prototype._isConnected=function(){return this.ws!==null&&this.ws.readyState===1},d.prototype.disconnect=function(){return new Promise((r,a)=>{this.ws!==null&&this.ws.readyState!==3?(this.wasCloseCalled=!0,this.log.info("Disconnecting from server.."),this.ws.close(),this.once("_promiseDisconnect",()=>r([this.server,~~this.port]))):(this.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),a("Cannot disconnect from server. Socket is not opened or connection is already closing."))})},d.prototype.off=d.prototype.removeListener,t.exports&&(t.exports=d),typeof window!="undefined"&&(window.tmi={client:d,Client:d})})(ys);const ts=ys.exports;var di={client:ts,Client:ts};let ks=new Map(Object.entries(JSON.parse(localStorage.users||"{}")));ks.forEach(t=>{delete t.timedout,delete t.timerID});const Se=We(ks);Se.subscribe(t=>{localStorage.users=JSON.stringify(Object.fromEntries(t))});const De=We(JSON.parse(localStorage.config||"{}"));De.subscribe(t=>{localStorage.config=JSON.stringify(t)});const ft=We([]);function ss(t,e,s){const i=t.slice();return i[26]=e[s][0],i[27]=e[s][1],i[28]=e,i[29]=s,i}function pi(t){let e,s,i,n,o,l,p,h,g;return{c(){e=E("div"),s=E("button"),i=q("Desconectar"),n=H(),o=E("div"),l=E("p"),p=q("Status: Conectado \xE0 Twitch"),this.h()},l(c){e=C(c,"DIV",{});var _=O(e);s=C(_,"BUTTON",{class:!0});var d=O(s);i=z(d,"Desconectar"),d.forEach(y),_.forEach(y),n=J(c),o=C(c,"DIV",{});var w=O(o);l=C(w,"P",{class:!0});var r=O(l);p=z(r,"Status: Conectado \xE0 Twitch"),r.forEach(y),w.forEach(y),this.h()},h(){A(s,"class","rounded-md bg-red-500 m-2 border-8 border-red-500"),A(l,"class","rounded-md bg-green-500 m-2 border-8 border-green-500 w-fit")},m(c,_){Y(c,e,_),u(e,s),u(s,i),Y(c,n,_),Y(c,o,_),u(o,l),u(l,p),h||(g=ae(s,"click",t[12]),h=!0)},p:ve,d(c){c&&y(e),c&&y(n),c&&y(o),h=!1,g()}}}function mi(t){let e,s,i,n,o,l,p;return{c(){e=E("div"),s=E("span"),i=q("\xA0"),n=H(),o=E("div"),l=E("p"),p=q("Status: Conectando \xE0 Twitch"),this.h()},l(h){e=C(h,"DIV",{});var g=O(e);s=C(g,"SPAN",{});var c=O(s);i=z(c,"\xA0"),c.forEach(y),g.forEach(y),n=J(h),o=C(h,"DIV",{});var _=O(o);l=C(_,"P",{class:!0});var d=O(l);p=z(d,"Status: Conectando \xE0 Twitch"),d.forEach(y),_.forEach(y),this.h()},h(){A(l,"class","rounded-md bg-orange-500 m-2 border-8 border-orange-500 w-fit")},m(h,g){Y(h,e,g),u(e,s),u(s,i),Y(h,n,g),Y(h,o,g),u(o,l),u(l,p)},p:ve,d(h){h&&y(e),h&&y(n),h&&y(o)}}}function gi(t){let e,s,i,n,o,l,p,h,g;return{c(){e=E("div"),s=E("button"),i=q("Conectar"),n=H(),o=E("div"),l=E("p"),p=q("Status: Desconectado da Twitch"),this.h()},l(c){e=C(c,"DIV",{});var _=O(e);s=C(_,"BUTTON",{class:!0});var d=O(s);i=z(d,"Conectar"),d.forEach(y),_.forEach(y),n=J(c),o=C(c,"DIV",{});var w=O(o);l=C(w,"P",{class:!0});var r=O(l);p=z(r,"Status: Desconectado da Twitch"),r.forEach(y),w.forEach(y),this.h()},h(){A(s,"class","rounded-md bg-blue-500 m-2 border-8 border-blue-500"),A(l,"class","rounded-md bg-red-500 m-2 border-8 border-red-500 w-fit")},m(c,_){Y(c,e,_),u(e,s),u(s,i),Y(c,n,_),Y(c,o,_),u(o,l),u(l,p),h||(g=ae(s,"click",t[11]),h=!0)},p:ve,d(c){c&&y(e),c&&y(n),c&&y(o),h=!1,g()}}}function is(t){let e,s,i=t[26]+"",n,o,l,p,h,g,c,_,d,w,r,a,f,T,b,m,v,D;function x(...$){return t[18](t[26],...$)}function I(){t[19].call(a,t[28],t[29])}function F(...$){return t[20](t[26],...$)}function P(){t[21].call(b,t[28],t[29])}function L(...$){return t[22](t[26],...$)}return{c(){e=E("tr"),s=E("td"),n=q(i),o=H(),l=E("td"),p=E("input"),g=H(),c=E("td"),_=E("input"),w=H(),r=E("td"),a=E("input"),f=H(),T=E("td"),b=E("input"),m=H(),this.h()},l($){e=C($,"TR",{});var M=O(e);s=C(M,"TD",{class:!0});var k=O(s);n=z(k,i),k.forEach(y),o=J(M),l=C(M,"TD",{class:!0});var N=O(l);p=C(N,"INPUT",{type:!0,class:!0}),N.forEach(y),g=J(M),c=C(M,"TD",{class:!0});var S=O(c);_=C(S,"INPUT",{type:!0,class:!0}),S.forEach(y),w=J(M),r=C(M,"TD",{class:!0});var U=O(r);a=C(U,"INPUT",{type:!0,class:!0}),U.forEach(y),f=J(M),T=C(M,"TD",{class:!0});var B=O(T);b=C(B,"INPUT",{type:!0,class:!0}),B.forEach(y),m=J(M),M.forEach(y),this.h()},h(){A(s,"class","border border-slate-300 text-center px-10"),A(p,"type","checkbox"),p.checked=h=t[27].banned||!1,A(p,"class","svelte-109pnf3"),A(l,"class","border border-slate-300 text-center"),A(_,"type","checkbox"),_.checked=d=t[27].timedout||!1,A(_,"class","svelte-109pnf3"),A(c,"class","border border-slate-300 text-center"),A(a,"type","number"),A(a,"class","svelte-109pnf3"),A(r,"class","border border-slate-300 text-center"),A(b,"type","number"),A(b,"class","svelte-109pnf3"),A(T,"class","border border-slate-300 text-center")},m($,M){Y($,e,M),u(e,s),u(s,n),u(e,o),u(e,l),u(l,p),u(e,g),u(e,c),u(c,_),u(e,w),u(e,r),u(r,a),ue(a,t[27].minuteLimit),u(e,f),u(e,T),u(T,b),ue(b,t[27].hourLimit),u(e,m),v||(D=[ae(p,"click",function(){gs(t[7](t[26],!t[27].banned))&&t[7](t[26],!t[27].banned).apply(this,arguments)}),ae(_,"change",x),ae(a,"input",I),ae(a,"change",F),ae(b,"input",P),ae(b,"change",L)],v=!0)},p($,M){t=$,M&112&&i!==(i=t[26]+"")&&ht(n,i),M&112&&h!==(h=t[27].banned||!1)&&(p.checked=h),M&112&&d!==(d=t[27].timedout||!1)&&(_.checked=d),M&112&&ye(a.value)!==t[27].minuteLimit&&ue(a,t[27].minuteLimit),M&112&&ye(b.value)!==t[27].hourLimit&&ue(b,t[27].hourLimit)},d($){$&&y(e),v=!1,wt(D)}}}function _i(t){let e,s,i,n,o,l,p,h,g,c,_,d,w,r,a,f,T,b,m,v,D,x,I,F,P,L,$,M,k,N,S,U,B,G,ne,oe,le,Z,X,pe;function Ee(j,re){if(j[3]==="disconnected")return gi;if(j[3]==="connecting")return mi;if(j[3]==="connected")return pi}let me=Ee(t),te=me&&me(t),ge=[...t[6]].filter(t[16]).filter(t[17]),se=[];for(let j=0;j<ge.length;j+=1)se[j]=is(ss(t,ge,j));return{c(){te&&te.c(),e=H(),s=E("dialog"),i=E("form"),n=E("section"),o=E("p"),l=q("Timeout em minutos:"),p=H(),h=E("input"),g=H(),c=E("menu"),_=E("button"),d=q("Cancelar"),w=H(),r=E("button"),a=q("Confirmar"),f=H(),T=E("div"),b=E("input"),m=H(),v=E("table"),D=E("thead"),x=E("tr"),I=E("th"),F=q("Usu\xE1rio"),P=H(),L=E("th"),$=q("Banido"),M=H(),k=E("th"),N=q("Timed out"),S=H(),U=E("th"),B=q("Mensagens/minuto"),G=H(),ne=E("th"),oe=q("Mensagens/hora"),le=H(),Z=E("tbody");for(let j=0;j<se.length;j+=1)se[j].c();this.h()},l(j){te&&te.l(j),e=J(j),s=C(j,"DIALOG",{id:!0,class:!0});var re=O(s);i=C(re,"FORM",{method:!0});var K=O(i);n=C(K,"SECTION",{});var _e=O(n);o=C(_e,"P",{});var Ie=O(o);l=z(Ie,"Timeout em minutos:"),Ie.forEach(y),p=J(_e),h=C(_e,"INPUT",{type:!0,class:!0}),_e.forEach(y),g=J(K),c=C(K,"MENU",{});var Ae=O(c);_=C(Ae,"BUTTON",{id:!0,class:!0,type:!0});var Pe=O(_);d=z(Pe,"Cancelar"),Pe.forEach(y),w=J(Ae),r=C(Ae,"BUTTON",{type:!0,class:!0});var ze=O(r);a=z(ze,"Confirmar"),ze.forEach(y),Ae.forEach(y),K.forEach(y),re.forEach(y),f=J(j),T=C(j,"DIV",{class:!0});var Ge=O(T);b=C(Ge,"INPUT",{type:!0,placeholder:!0,class:!0}),m=J(Ge),v=C(Ge,"TABLE",{class:!0});var Ke=O(v);D=C(Ke,"THEAD",{});var Tt=O(D);x=C(Tt,"TR",{});var be=O(x);I=C(be,"TH",{class:!0});var St=O(I);F=z(St,"Usu\xE1rio"),St.forEach(y),P=J(be),L=C(be,"TH",{class:!0});var Nt=O(L);$=z(Nt,"Banido"),Nt.forEach(y),M=J(be),k=C(be,"TH",{class:!0});var Ot=O(k);N=z(Ot,"Timed out"),Ot.forEach(y),S=J(be),U=C(be,"TH",{class:!0});var Lt=O(U);B=z(Lt,"Mensagens/minuto"),Lt.forEach(y),G=J(be),ne=C(be,"TH",{class:!0});var At=O(ne);oe=z(At,"Mensagens/hora"),At.forEach(y),be.forEach(y),Tt.forEach(y),le=J(Ke),Z=C(Ke,"TBODY",{});var Rt=O(Z);for(let rt=0;rt<se.length;rt+=1)se[rt].l(Rt);Rt.forEach(y),Ke.forEach(y),Ge.forEach(y),this.h()},h(){A(h,"type","number"),A(h,"class","svelte-109pnf3"),A(_,"id","cancel"),A(_,"class","rounded-md bg-red-500 m-2 border-8 border-red-500"),A(_,"type","reset"),A(r,"type","submit"),A(r,"class","rounded-md bg-green-500 m-2 border-8 border-green-500"),A(i,"method","dialog"),A(s,"id","timeoutLength"),A(s,"class","rounded-2xl"),A(b,"type","text"),A(b,"placeholder","Buscar..."),A(b,"class","text-center justify-center svelte-109pnf3"),A(I,"class","border border-slate-300"),A(L,"class","border border-slate-300 px-5"),A(k,"class","border border-slate-300 px-5"),A(U,"class","border border-slate-300 px-5"),A(ne,"class","border border-slate-300 px-5"),A(v,"class","border-collapse border border-slate-400"),A(T,"class","grid place-items-center")},m(j,re){te&&te.m(j,re),Y(j,e,re),Y(j,s,re),u(s,i),u(i,n),u(n,o),u(o,l),u(n,p),u(n,h),ue(h,t[0]),u(i,g),u(i,c),u(c,_),u(_,d),u(c,w),u(c,r),u(r,a),Y(j,f,re),Y(j,T,re),u(T,b),ue(b,t[4]),u(T,m),u(T,v),u(v,D),u(D,x),u(x,I),u(I,F),u(x,P),u(x,L),u(L,$),u(x,M),u(x,k),u(k,N),u(x,S),u(x,U),u(U,B),u(x,G),u(x,ne),u(ne,oe),u(v,le),u(v,Z);for(let K=0;K<se.length;K+=1)se[K].m(Z,null);X||(pe=[ae(h,"input",t[13]),ae(_,"click",function(){gs(t[2])&&t[2].apply(this,arguments)}),ae(r,"click",t[14]),ae(b,"input",t[15])],X=!0)},p(j,[re]){if(t=j,me===(me=Ee(t))&&te?te.p(t,re):(te&&te.d(1),te=me&&me(t),te&&(te.c(),te.m(e.parentNode,e))),re&1&&ye(h.value)!==t[0]&&ue(h,t[0]),re&16&&b.value!==t[4]&&ue(b,t[4]),re&2039){ge=[...t[6]].filter(t[16]).filter(t[17]);let K;for(K=0;K<ge.length;K+=1){const _e=ss(t,ge,K);se[K]?se[K].p(_e,re):(se[K]=is(_e),se[K].c(),se[K].m(Z,null))}for(;K<se.length;K+=1)se[K].d(1);se.length=ge.length}},i:ve,o:ve,d(j){te&&te.d(j),j&&y(e),j&&y(s),j&&y(f),j&&y(T),_s(se,j),X=!1,wt(pe)}}}function bi(t,e,s){let i,n,o;He(t,ft,k=>s(23,i=k)),He(t,De,k=>s(5,n=k)),He(t,Se,k=>s(6,o=k));let l=0,p,h,g="disconnected",c="",_=new Map;const d=new di.Client({channels:[n.channel]});function w(k,N){Se.update(S=>S.set(k,Ce(fe({},S.get(k)),{banned:N})))}function r(k,N,S){var U;if(Se.update(B=>B.set(k,Ce(fe({},B.get(k)),{timedout:N}))),N){clearTimeout((U=o.get(k))==null?void 0:U.timerID);const B=setTimeout(()=>{Se.update(G=>G.set(k,Ce(fe({},G.get(k)),{timedout:!1})))},S*1e3*60);Se.update(G=>G.set(k,Ce(fe({},G.get(k)),{timerID:B})))}s(0,l=0)}function a(k,N){Se.update(S=>S.set(k,Ce(fe({},S.get(k)),{minuteLimit:N})))}function f(k,N){Se.update(S=>S.set(k,Ce(fe({},S.get(k)),{hourLimit:N})))}function T(){d.on("connecting",(k,N)=>{console.log("Conectando \xE0 Twitch"),s(3,g="connecting")}),d.on("connected",(k,N)=>{console.log("Conectado \xE0 Twitch"),s(3,g="connected")}),d.on("disconnected",k=>{console.log("Disconectado da Twitch"),s(3,g="disconnected")}),d.connect(),d.on("chat",(k,N,S,U)=>{var ne,oe,le,Z;if(U||!S.startsWith("!"))return;const B=S.slice(1).split(" "),G=B.shift().toLowerCase();if(G==="voz"){if(console.log("Recebeu comando de voz"),_.has(N.username)||_.set(N.username,new Set),((ne=o.get(N.username))==null?void 0:ne.banned)||((oe=o.get(N.username))==null?void 0:oe.timedout)||N.username in["deftbizk"])return;let X=(le=o.get(N.username))!=null&&le.minuteLimit?o.get(N.username).minuteLimit:n.minuteLimit,pe=(Z=o.get(N.username))!=null&&Z.hourLimit?o.get(N.username).hourLimit:n.hourLimit;if(isNaN(parseInt(X))&&(X=Number.MAX_SAFE_INTEGER),isNaN(parseInt(pe))&&(pe=Number.MAX_SAFE_INTEGER),[..._.get(N.username)].filter(Ee=>Date.now()-Ee<60*1e3).length>=X||[..._.get(N.username)].filter(Ee=>Date.now()-Ee<60*60*1e3).length>=pe)return;_.get(N.username).add(Date.now()),i.push(B.join(" ")),console.log("Mensagem adicionada \xE0 fila: "+B.join(" "))}!(N.mod||N.username===k.slice(1))||(G==="voz_ban"?w(B[0],!0):G==="voz_unban"?w(B[0],!1):G==="voz_timeout"?r(B[0],!0,B[1]):G==="voz_remove_timeout"?r(B[0],!1):G==="voz_limite_minuto"?a(B[0],B[1]):G==="voz_limite_hora"?f(B[0],B[1]):G==="voz_limite"&&(a(B[0],B[1]),f(B[0],B[1])))})}function b(){d.disconnect()}function m(){l=ye(this.value),s(0,l)}const v=()=>r(p,!0,l);function D(){c=this.value,s(4,c)}const x=([k,N])=>k.includes(c),I=([k,N])=>N.banned==!0||N.timedout==!0||N.minuteLimit&&N.minuteLimit!=n.minuteLimit||N.hourLimit&&N.hourLimit!=n.hourLimit,F=(k,N)=>{if(N.currentTarget.checked){s(1,p=k);let S=N.currentTarget;s(2,h=function(){document.querySelector("#timeoutLength").close(),S.checked=!1,s(0,l=0)}),document.querySelector("#timeoutLength").showModal()}else r(k,!1)};function P(k,N){k[N][1].minuteLimit=ye(this.value),s(4,c)}const L=(k,N)=>a(k,N.target.value);function $(k,N){k[N][1].hourLimit=ye(this.value),s(4,c)}return[l,p,h,g,c,n,o,w,r,a,f,T,b,m,v,D,x,I,F,P,L,$,(k,N)=>f(k,N.target.value)]}class yi extends bt{constructor(e){super(),yt(this,e,bi,_i,vt,{})}}const Q={},Re=globalThis,V={status:"created"},ie={};Q.debug=t=>{Ue=typeof t=="function"?t:()=>{}};let Ue=()=>{};Q.detect=()=>Es();const Es=()=>{const t={};["speechSynthesis","speechSynthesisUtterance","speechSynthesisVoice","speechSynthesisEvent","speechSynthesisErrorEvent"].forEach(s=>{t[s]=Ci(s)}),t.onvoiceschanged=st(t.speechSynthesis,"onvoiceschanged");const e=st(t.speechSynthesisUtterance,"prototype");return kt.forEach(s=>{const i=`on${s}`;t[i]=e&&st(t.speechSynthesisUtterance.prototype,i)}),ie.isAndroid=vi(),ie.isFirefox=wi(),t},st=(t={},e)=>Object.hasOwnProperty.call(t,e)||e in t||!!t[e],vi=()=>{const t=(Re.navigator||{}).userAgent||"";return/android/i.test(t)},wi=()=>typeof Re.InstallTrigger!="undefined",ki=["webKit","moz","ms","o"],Ei=t=>`${t.charAt(0).toUpperCase()}${t.slice(1)}`,Ci=t=>{const e=Ei(t),s=ki.map(n=>`${n}${e}`),i=[t,e].concat(s).find(Ti);return Re[i]},Ti=t=>Re[t];Q.status=()=>fe({},V);const he=t=>{Ue(t),V.status=t};Q.init=function({maxTimeout:t=5e3,interval:e=250}={}){return new Promise((s,i)=>{if(V.initialized)return s(!1);Q.reset(),he("init: start");let n,o,l=!1;const p=r=>(he(`init: failed (${r})`),clearInterval(n),V.initialized=!1,i(new Error(`EasySpeech: ${r}`))),h=()=>{if(!l)return he("init: complete"),l=!0,V.initialized=!0,clearInterval(n),_.onvoiceschanged=null,o&&_.removeEventListener("voiceschanged",o),s(!0)},g=Es();if(!(!!g.speechSynthesis&&!!g.speechSynthesisUtterance))return p("browser misses features");Object.keys(g).forEach(r=>{V[r]=g[r]});const{speechSynthesis:_}=V,d=()=>{const r=_.getVoices()||[];if(r.length>0){if(V.voices=r,he(`voices loaded: ${r.length}`),V.defaultVoice=r.find(a=>a.default),!V.defaultVoice){const f=((Re.navigator||{}).language||"").split("-")[0];V.defaultVoice=r.find(T=>T.lang&&(T.lang.indexOf(`${f}-`)>-1||T.lang.indexOf(`${f}_`)>-1))}return V.defaultVoice||(V.defaultVoice=r[0]),!0}return!1};if(he("init: voices"),d())return h();const w=()=>{he("init: voices (timer)");let r=0;n=setInterval(()=>{if(d())return h();if(r>t)return p("browser has no voices (timeout)");r+=e},e)};g.onvoiceschanged?(he("init: voices (onvoiceschanged)"),_.onvoiceschanged=()=>d()?h():w()):(st(_,"addEventListener")&&(he("init: voices (addEventListener)"),o=()=>{if(d())return h()},_.addEventListener("voiceschanged",o)),w())})};const xe=()=>{if(!V.initialized)throw new Error("EasySpeech: not initialized. Run EasySpeech.init() first")};Q.voices=()=>(xe(),V.voices);Q.on=t=>(xe(),kt.forEach(e=>{const s=t[e];Le.handler(s)&&(V.handlers[e]=s)}),fe({},V.handlers));const kt=["boundary","end","error","mark","pause","resume","start"],Le={isNumber:t=>typeof t=="number"&&!Number.isNaN(t),pitch:t=>Le.isNumber(t)&&t>=0&&t<=2,volume:t=>Le.isNumber(t)&&t>=0&&t<=1,rate:t=>Le.isNumber(t)&&t>=.1&&t<=10,text:t=>typeof t=="string",handler:t=>typeof t=="function",voice:t=>t&&t.lang&&t.name&&t.voiceURI};Q.defaults=t=>(xe(),t&&(V.defaults=V.defaults||{},["voice","pitch","rate","volume"].forEach(e=>{const s=t[e];Le[e](s)&&(V.defaults[e]=s)})),fe({},V.defaults));const Si=t=>t||V.defaults.voice||V.defaultVoice||V.voices[0]||{},Ni=t=>{const e=V.speechSynthesisUtterance;return new e(t)};Q.speak=l=>{var p=l,{text:t,voice:e,pitch:s,rate:i,volume:n}=p,o=$t(p,["text","voice","pitch","rate","volume"]);if(xe(),!Le.text(t))throw new Error("EasySpeech: at least some valid text is required to speak");const h=g=>{const[c,_]=Object.entries(g)[0];return Le[c](_)?_:V.defaults&&V.defaults[c]};return new Promise((g,c)=>{he("init speak");const _=Ni(t),d=Si(e);_.voice=d,_.lang=d.lang,_.voiceURI=d.voiceURI,_.text=t,_.pitch=h({pitch:s}),_.rate=h({rate:i}),_.volume=h({volume:n}),Oi(_),kt.forEach(w=>{const r=o[w];Le.handler(r)&&_.addEventListener(w,r),V.handlers[w]&&_.addEventListener(w,V.handlers[w])}),_.addEventListener("start",()=>{ie.paused=!1,ie.speaking=!0,!ie.isFirefox&&ie.isAndroid!==!0&&Cs(_)}),_.addEventListener("end",w=>{he("speak complete"),ie.paused=!1,ie.speaking=!1,clearTimeout(Me),g(w)}),_.addEventListener("error",(w={})=>{he(`speak failed: ${w.message}`),ie.paused=!1,ie.speaking=!1,clearTimeout(Me),c(w)}),clearTimeout(Me),V.speechSynthesis.cancel(),setTimeout(()=>{V.speechSynthesis.speak(_)},10)})};const Oi=({voice:t,pitch:e,rate:s,volume:i})=>{Ue(`utterance: voice=${t.name} volume=${i} rate=${s} pitch=${e}`)};let Me;function Cs(t){if(!t&&Me)return Ue("force-clear timeout"),Re.clearTimeout(Me);const{paused:e,speaking:s}=V.speechSynthesis,i=s||ie.speaking,n=e||ie.paused;Ue(`resumeInfinity isSpeaking=${i} isPaused=${n}`),i&&!n&&(V.speechSynthesis.pause(),V.speechSynthesis.resume()),Me=Re.setTimeout(function(){Cs(t)},5e3)}Q.cancel=()=>{xe(),he("cancelling"),V.speechSynthesis.cancel(),ie.paused=!1,ie.speaking=!1};Q.resume=()=>{xe(),he("resuming"),ie.paused=!1,ie.speaking=!0,V.speechSynthesis.resume()};Q.pause=()=>{if(xe(),he("pausing"),ie.isAndroid)return Ue("patch pause on Android with cancel"),V.speechSynthesis.cancel();V.speechSynthesis.pause(),ie.paused=!0,ie.speaking=!1};Q.reset=()=>{Object.assign(V,{status:"reset",initialized:!1,speechSynthesis:null,speechSynthesisUtterance:null,speechSynthesisVoice:null,speechSynthesisEvent:null,speechSynthesisErrorEvent:null,voices:null,defaultVoice:null,defaults:{pitch:1,rate:1,volume:1,voice:null},handlers:{}})};function ns(t,e,s){const i=t.slice();return i[4]=e[s],i[6]=s,i}function os(t){let e,s=t[4].name+"",i,n,o=t[4].lang+"",l,p;return{c(){e=E("option"),i=q(s),n=q(" - "),l=q(o),this.h()},l(h){e=C(h,"OPTION",{});var g=O(e);i=z(g,s),n=z(g," - "),l=z(g,o),g.forEach(y),this.h()},h(){e.__value=p=t[6],e.value=e.__value},m(h,g){Y(h,e,g),u(e,i),u(e,n),u(e,l)},p(h,g){g&1&&s!==(s=h[4].name+"")&&ht(i,s),g&1&&o!==(o=h[4].lang+"")&&ht(l,o)},d(h){h&&y(e)}}}function Li(t){let e,s,i,n,o,l,p,h=t[0],g=[];for(let c=0;c<h.length;c+=1)g[c]=os(ns(t,h,c));return{c(){e=E("div"),s=E("span"),i=q("Voz:"),n=H(),o=E("select");for(let c=0;c<g.length;c+=1)g[c].c();this.h()},l(c){e=C(c,"DIV",{class:!0});var _=O(e);s=C(_,"SPAN",{});var d=O(s);i=z(d,"Voz:"),d.forEach(y),n=J(_),o=C(_,"SELECT",{});var w=O(o);for(let r=0;r<g.length;r+=1)g[r].l(w);w.forEach(y),_.forEach(y),this.h()},h(){t[1]===void 0&&bs(()=>t[2].call(o)),A(e,"class","m-4")},m(c,_){Y(c,e,_),u(e,s),u(s,i),u(e,n),u(e,o);for(let d=0;d<g.length;d+=1)g[d].m(o,null);Bt(o,t[1]),l||(p=ae(o,"change",t[2]),l=!0)},p(c,[_]){if(_&1){h=c[0];let d;for(d=0;d<h.length;d+=1){const w=ns(c,h,d);g[d]?g[d].p(w,_):(g[d]=os(w),g[d].c(),g[d].m(o,null))}for(;d<g.length;d+=1)g[d].d(1);g.length=h.length}_&2&&Bt(o,c[1])},i:ve,o:ve,d(c){c&&y(e),_s(g,c),l=!1,p()}}}function Ai(t,e,s){let i;He(t,ft,p=>s(3,i=p));let n=[],o;Q.init({maxTimeout:5e3,interval:250}).then(()=>{console.log("EasySpeech load complete."),s(0,n=Q.voices()),s(1,o=n.findIndex(p=>p.lang==="pt-BR")),setInterval(async()=>{i.length==0||Q.status().status==="init speak"||Q.status().status==="pausing"||Q.status().status==="resuming"||(console.log("Lendo uma mensagem"),await Q.speak({text:i.shift(),voice:n[o],pitch:1,rate:1,volume:1}))},250),window.addEventListener("pause_speech",()=>{Q.status().status==="pausing"?Q.resume():Q.pause()}),window.addEventListener("cancel_speech",()=>{zs(ft,i=[],i),window.speechSynthesis.cancel()}),window.addEventListener("skip_message",()=>{Q.cancel()})}).catch(p=>console.error(p));function l(){o=Fs(this),s(1,o)}return[n,o,l]}class Ri extends bt{constructor(e){super(),yt(this,e,Ai,Li,vt,{})}}const ke=Object.create(null);ke.open="0";ke.close="1";ke.ping="2";ke.pong="3";ke.message="4";ke.upgrade="5";ke.noop="6";const it=Object.create(null);Object.keys(ke).forEach(t=>{it[ke[t]]=t});const xi={type:"error",data:"parser error"},Ii=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Pi=typeof ArrayBuffer=="function",$i=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Ts=({type:t,data:e},s,i)=>Ii&&e instanceof Blob?s?i(e):rs(e,i):Pi&&(e instanceof ArrayBuffer||$i(e))?s?i(e):rs(new Blob([e]),i):i(ke[t]+(e||"")),rs=(t,e)=>{const s=new FileReader;return s.onload=function(){const i=s.result.split(",")[1];e("b"+i)},s.readAsDataURL(t)},as="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",je=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let t=0;t<as.length;t++)je[as.charCodeAt(t)]=t;const Bi=t=>{let e=t.length*.75,s=t.length,i,n=0,o,l,p,h;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const g=new ArrayBuffer(e),c=new Uint8Array(g);for(i=0;i<s;i+=4)o=je[t.charCodeAt(i)],l=je[t.charCodeAt(i+1)],p=je[t.charCodeAt(i+2)],h=je[t.charCodeAt(i+3)],c[n++]=o<<2|l>>4,c[n++]=(l&15)<<4|p>>2,c[n++]=(p&3)<<6|h&63;return g},Di=typeof ArrayBuffer=="function",Ss=(t,e)=>{if(typeof t!="string")return{type:"message",data:Ns(t,e)};const s=t.charAt(0);return s==="b"?{type:"message",data:Mi(t.substring(1),e)}:it[s]?t.length>1?{type:it[s],data:t.substring(1)}:{type:it[s]}:xi},Mi=(t,e)=>{if(Di){const s=Bi(t);return Ns(s,e)}else return{base64:!0,data:t}},Ns=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}},Os=String.fromCharCode(30),Ui=(t,e)=>{const s=t.length,i=new Array(s);let n=0;t.forEach((o,l)=>{Ts(o,!1,p=>{i[l]=p,++n===s&&e(i.join(Os))})})},Vi=(t,e)=>{const s=t.split(Os),i=[];for(let n=0;n<s.length;n++){const o=Ss(s[n],e);if(i.push(o),o.type==="error")break}return i},Ls=4;function ee(t){if(t)return qi(t)}function qi(t){for(var e in ee.prototype)t[e]=ee.prototype[e];return t}ee.prototype.on=ee.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};ee.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this};ee.prototype.off=ee.prototype.removeListener=ee.prototype.removeAllListeners=ee.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+t];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var i,n=0;n<s.length;n++)if(i=s[n],i===e||i.fn===e){s.splice(n,1);break}return s.length===0&&delete this._callbacks["$"+t],this};ee.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+t],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(s){s=s.slice(0);for(var i=0,n=s.length;i<n;++i)s[i].apply(this,e)}return this};ee.prototype.emitReserved=ee.prototype.emit;ee.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};ee.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Oe=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function As(t,...e){return e.reduce((s,i)=>(t.hasOwnProperty(i)&&(s[i]=t[i]),s),{})}const zi=setTimeout,Fi=clearTimeout;function ot(t,e){e.useNativeTimers?(t.setTimeoutFn=zi.bind(Oe),t.clearTimeoutFn=Fi.bind(Oe)):(t.setTimeoutFn=setTimeout.bind(Oe),t.clearTimeoutFn=clearTimeout.bind(Oe))}const ji=1.33;function Hi(t){return typeof t=="string"?Ji(t):Math.ceil((t.byteLength||t.size)*ji)}function Ji(t){let e=0,s=0;for(let i=0,n=t.length;i<n;i++)e=t.charCodeAt(i),e<128?s+=1:e<2048?s+=2:e<55296||e>=57344?s+=3:(i++,s+=4);return s}class Wi extends Error{constructor(e,s,i){super(e),this.description=s,this.context=i,this.type="TransportError"}}class Rs extends ee{constructor(e){super(),this.writable=!1,ot(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,s,i){return super.emitReserved("error",new Wi(e,s,i)),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const s=Ss(e,this.socket.binaryType);this.onPacket(s)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const xs="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),dt=64,Gi={};let cs=0,Qe=0,ls;function hs(t){let e="";do e=xs[t%dt]+e,t=Math.floor(t/dt);while(t>0);return e}function Is(){const t=hs(+new Date);return t!==ls?(cs=0,ls=t):t+"."+hs(cs++)}for(;Qe<dt;Qe++)Gi[xs[Qe]]=Qe;function Ps(t){let e="";for(let s in t)t.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e}function Ki(t){let e={},s=t.split("&");for(let i=0,n=s.length;i<n;i++){let o=s[i].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}let $s=!1;try{$s=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch{}const Yi=$s;function Bs(t){const e=t.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||Yi))return new XMLHttpRequest}catch{}if(!e)try{return new Oe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Xi(){}const Qi=function(){return new Bs({xdomain:!1}).responseType!=null}();class Zi extends Rs{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const i=location.protocol==="https:";let n=location.port;n||(n=i?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==i}const s=e&&e.forceBase64;this.supportsBinary=Qi&&!s}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const s=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let i=0;this.polling&&(i++,this.once("pollComplete",function(){--i||s()})),this.writable||(i++,this.once("drain",function(){--i||s()}))}else s()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const s=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};Vi(e,this.socket.binaryType).forEach(s),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Ui(e,s=>{this.doWrite(s,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const s=this.opts.secure?"https":"http";let i="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Is()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(s==="https"&&Number(this.opts.port)!==443||s==="http"&&Number(this.opts.port)!==80)&&(i=":"+this.opts.port);const n=Ps(e),o=this.opts.hostname.indexOf(":")!==-1;return s+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(n.length?"?"+n:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new we(this.uri(),e)}doWrite(e,s){const i=this.request({method:"POST",data:e});i.on("success",s),i.on("error",(n,o)=>{this.onError("xhr post error",n,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(s,i)=>{this.onError("xhr poll error",s,i)}),this.pollXhr=e}}class we extends ee{constructor(e,s){super(),ot(this,s),this.opts=s,this.method=s.method||"GET",this.uri=e,this.async=s.async!==!1,this.data=s.data!==void 0?s.data:null,this.create()}create(){const e=As(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const s=this.xhr=new Bs(e);try{s.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this.opts.extraHeaders[i])}}catch{}if(this.method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in s&&(s.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(s.timeout=this.opts.requestTimeout),s.onreadystatechange=()=>{s.readyState===4&&(s.status===200||s.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof s.status=="number"?s.status:0)},0))},s.send(this.data)}catch(i){this.setTimeoutFn(()=>{this.onError(i)},0);return}typeof document!="undefined"&&(this.index=we.requestsCount++,we.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=Xi,e)try{this.xhr.abort()}catch{}typeof document!="undefined"&&delete we.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}we.requestsCount=0;we.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",us);else if(typeof addEventListener=="function"){const t="onpagehide"in Oe?"pagehide":"unload";addEventListener(t,us,!1)}}function us(){for(let t in we.requests)we.requests.hasOwnProperty(t)&&we.requests[t].abort()}const en=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,s)=>s(e,0))(),Ze=Oe.WebSocket||Oe.MozWebSocket,fs=!0,tn="arraybuffer",ds=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class sn extends Rs{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),s=this.opts.protocols,i=ds?{}:As(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=fs&&!ds?s?new Ze(e,s):new Ze(e):new Ze(e,s,i)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType||tn,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const i=e[s],n=s===e.length-1;Ts(i,this.supportsBinary,o=>{const l={};try{fs&&this.ws.send(o)}catch{}n&&en(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const s=this.opts.secure?"wss":"ws";let i="";this.opts.port&&(s==="wss"&&Number(this.opts.port)!==443||s==="ws"&&Number(this.opts.port)!==80)&&(i=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Is()),this.supportsBinary||(e.b64=1);const n=Ps(e),o=this.opts.hostname.indexOf(":")!==-1;return s+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(n.length?"?"+n:"")}check(){return!!Ze}}const nn={websocket:sn,polling:Zi},on=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,rn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function pt(t){const e=t,s=t.indexOf("["),i=t.indexOf("]");s!=-1&&i!=-1&&(t=t.substring(0,s)+t.substring(s,i).replace(/:/g,";")+t.substring(i,t.length));let n=on.exec(t||""),o={},l=14;for(;l--;)o[rn[l]]=n[l]||"";return s!=-1&&i!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=an(o,o.path),o.queryKey=cn(o,o.query),o}function an(t,e){const s=/\/{2,9}/g,i=e.replace(s,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&i.splice(0,1),e.substr(e.length-1,1)=="/"&&i.splice(i.length-1,1),i}function cn(t,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,n,o){n&&(s[n]=o)}),s}class Ne extends ee{constructor(e,s={}){super(),e&&typeof e=="object"&&(s=e,e=null),e?(e=pt(e),s.hostname=e.host,s.secure=e.protocol==="https"||e.protocol==="wss",s.port=e.port,e.query&&(s.query=e.query)):s.host&&(s.hostname=pt(s.host).host),ot(this,s),this.secure=s.secure!=null?s.secure:typeof location!="undefined"&&location.protocol==="https:",s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.hostname=s.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=s.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=s.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},s),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=Ki(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const s=Object.assign({},this.opts.query);s.EIO=Ls,s.transport=e,this.id&&(s.sid=this.id);const i=Object.assign({},this.opts.transportOptions[e],this.opts,{query:s,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new nn[e](i)}open(){let e;if(this.opts.rememberUpgrade&&Ne.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",s=>this.onClose("transport close",s))}probe(e){let s=this.createTransport(e),i=!1;Ne.priorWebsocketSuccess=!1;const n=()=>{i||(s.send([{type:"ping",data:"probe"}]),s.once("packet",_=>{if(!i)if(_.type==="pong"&&_.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",s),!s)return;Ne.priorWebsocketSuccess=s.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(c(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=s.name,this.emitReserved("upgradeError",d)}}))};function o(){i||(i=!0,c(),s.close(),s=null)}const l=_=>{const d=new Error("probe error: "+_);d.transport=s.name,o(),this.emitReserved("upgradeError",d)};function p(){l("transport closed")}function h(){l("socket closed")}function g(_){s&&_.name!==s.name&&o()}const c=()=>{s.removeListener("open",n),s.removeListener("error",l),s.removeListener("close",p),this.off("close",h),this.off("upgrading",g)};s.once("open",n),s.once("error",l),s.once("close",p),this.once("close",h),this.once("upgrading",g),s.open()}onOpen(){if(this.readyState="open",Ne.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let e=0;const s=this.upgrades.length;for(;e<s;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const s=new Error("server error");s.code=e.data,this.onError(s);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let s=1;for(let i=0;i<this.writeBuffer.length;i++){const n=this.writeBuffer[i].data;if(n&&(s+=Hi(n)),i>0&&s>this.maxPayload)return this.writeBuffer.slice(0,i);s+=2}return this.writeBuffer}write(e,s,i){return this.sendPacket("message",e,s,i),this}send(e,s,i){return this.sendPacket("message",e,s,i),this}sendPacket(e,s,i,n){if(typeof s=="function"&&(n=s,s=void 0),typeof i=="function"&&(n=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const o={type:e,data:s,options:i};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},s=()=>{this.off("upgrade",s),this.off("upgradeError",s),e()},i=()=>{this.once("upgrade",s),this.once("upgradeError",s)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}onError(e){Ne.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,s){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,s),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const s=[];let i=0;const n=e.length;for(;i<n;i++)~this.transports.indexOf(e[i])&&s.push(e[i]);return s}}Ne.protocol=Ls;function ln(t,e="",s){let i=t;s=s||typeof location!="undefined"&&location,t==null&&(t=s.protocol+"//"+s.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=s.protocol+t:t=s.host+t),/^(https?|wss?):\/\//.test(t)||(typeof s!="undefined"?t=s.protocol+"//"+t:t="https://"+t),i=pt(t)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const o=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+o+":"+i.port+e,i.href=i.protocol+"://"+o+(s&&s.port===i.port?"":":"+i.port),i}const hn=typeof ArrayBuffer=="function",un=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Ds=Object.prototype.toString,fn=typeof Blob=="function"||typeof Blob!="undefined"&&Ds.call(Blob)==="[object BlobConstructor]",dn=typeof File=="function"||typeof File!="undefined"&&Ds.call(File)==="[object FileConstructor]";function Et(t){return hn&&(t instanceof ArrayBuffer||un(t))||fn&&t instanceof Blob||dn&&t instanceof File}function nt(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let s=0,i=t.length;s<i;s++)if(nt(t[s]))return!0;return!1}if(Et(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return nt(t.toJSON(),!0);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&nt(t[s]))return!0;return!1}function pn(t){const e=[],s=t.data,i=t;return i.data=mt(s,e),i.attachments=e.length,{packet:i,buffers:e}}function mt(t,e){if(!t)return t;if(Et(t)){const s={_placeholder:!0,num:e.length};return e.push(t),s}else if(Array.isArray(t)){const s=new Array(t.length);for(let i=0;i<t.length;i++)s[i]=mt(t[i],e);return s}else if(typeof t=="object"&&!(t instanceof Date)){const s={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=mt(t[i],e));return s}return t}function mn(t,e){return t.data=gt(t.data,e),t.attachments=void 0,t}function gt(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=gt(t[s],e);else if(typeof t=="object")for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(t[s]=gt(t[s],e));return t}const gn=5;var W;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(W||(W={}));class _n{constructor(e){this.replacer=e}encode(e){return(e.type===W.EVENT||e.type===W.ACK)&&nt(e)?(e.type=e.type===W.EVENT?W.BINARY_EVENT:W.BINARY_ACK,this.encodeAsBinary(e)):[this.encodeAsString(e)]}encodeAsString(e){let s=""+e.type;return(e.type===W.BINARY_EVENT||e.type===W.BINARY_ACK)&&(s+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(s+=e.nsp+","),e.id!=null&&(s+=e.id),e.data!=null&&(s+=JSON.stringify(e.data,this.replacer)),s}encodeAsBinary(e){const s=pn(e),i=this.encodeAsString(s.packet),n=s.buffers;return n.unshift(i),n}}class Ct extends ee{constructor(e){super(),this.reviver=e}add(e){let s;if(typeof e=="string")s=this.decodeString(e),s.type===W.BINARY_EVENT||s.type===W.BINARY_ACK?(this.reconstructor=new bn(s),s.attachments===0&&super.emitReserved("decoded",s)):super.emitReserved("decoded",s);else if(Et(e)||e.base64)if(this.reconstructor)s=this.reconstructor.takeBinaryData(e),s&&(this.reconstructor=null,super.emitReserved("decoded",s));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let s=0;const i={type:Number(e.charAt(0))};if(W[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===W.BINARY_EVENT||i.type===W.BINARY_ACK){const o=s+1;for(;e.charAt(++s)!=="-"&&s!=e.length;);const l=e.substring(o,s);if(l!=Number(l)||e.charAt(s)!=="-")throw new Error("Illegal attachments");i.attachments=Number(l)}if(e.charAt(s+1)==="/"){const o=s+1;for(;++s&&!(e.charAt(s)===","||s===e.length););i.nsp=e.substring(o,s)}else i.nsp="/";const n=e.charAt(s+1);if(n!==""&&Number(n)==n){const o=s+1;for(;++s;){const l=e.charAt(s);if(l==null||Number(l)!=l){--s;break}if(s===e.length)break}i.id=Number(e.substring(o,s+1))}if(e.charAt(++s)){const o=this.tryParse(e.substr(s));if(Ct.isPayloadValid(i.type,o))i.data=o;else throw new Error("invalid payload")}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,s){switch(e){case W.CONNECT:return typeof s=="object";case W.DISCONNECT:return s===void 0;case W.CONNECT_ERROR:return typeof s=="string"||typeof s=="object";case W.EVENT:case W.BINARY_EVENT:return Array.isArray(s)&&s.length>0;case W.ACK:case W.BINARY_ACK:return Array.isArray(s)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class bn{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const s=mn(this.reconPack,this.buffers);return this.finishedReconstruction(),s}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var yn=Object.freeze(Object.defineProperty({__proto__:null,protocol:gn,get PacketType(){return W},Encoder:_n,Decoder:Ct},Symbol.toStringTag,{value:"Module"}));function de(t,e,s){return t.on(e,s),function(){t.off(e,s)}}const vn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ms extends ee{constructor(e,s,i){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=s,i&&i.auth&&(this.auth=i.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[de(e,"open",this.onopen.bind(this)),de(e,"packet",this.onpacket.bind(this)),de(e,"error",this.onerror.bind(this)),de(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...s){if(vn.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');s.unshift(e);const i={type:W.EVENT,data:s};if(i.options={},i.options.compress=this.flags.compress!==!1,typeof s[s.length-1]=="function"){const l=this.ids++,p=s.pop();this._registerAckCallback(l,p),i.id=l}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(e,s){const i=this.flags.timeout;if(i===void 0){this.acks[e]=s;return}const n=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);s.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(n),s.apply(this,[null,...o])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this.packet({type:W.CONNECT,data:e})}):this.packet({type:W.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,s){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,s)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case W.CONNECT:if(e.data&&e.data.sid){const n=e.data.sid;this.onconnect(n)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case W.EVENT:case W.BINARY_EVENT:this.onevent(e);break;case W.ACK:case W.BINARY_ACK:this.onack(e);break;case W.DISCONNECT:this.ondisconnect();break;case W.CONNECT_ERROR:this.destroy();const i=new Error(e.data.message);i.data=e.data.data,this.emitReserved("connect_error",i);break}}onevent(e){const s=e.data||[];e.id!=null&&s.push(this.ack(e.id)),this.connected?this.emitEvent(s):this.receiveBuffer.push(Object.freeze(s))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const s=this._anyListeners.slice();for(const i of s)i.apply(this,e)}super.emit.apply(this,e)}ack(e){const s=this;let i=!1;return function(...n){i||(i=!0,s.packet({type:W.ACK,id:e,data:n}))}}onack(e){const s=this.acks[e.id];typeof s=="function"&&(s.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:W.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const s=this._anyListeners;for(let i=0;i<s.length;i++)if(e===s[i])return s.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const s=this._anyOutgoingListeners;for(let i=0;i<s.length;i++)if(e===s[i])return s.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const s=this._anyOutgoingListeners.slice();for(const i of s)i.apply(this,e.data)}}}function qe(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}qe.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-s:t+s}return Math.min(t,this.max)|0};qe.prototype.reset=function(){this.attempts=0};qe.prototype.setMin=function(t){this.ms=t};qe.prototype.setMax=function(t){this.max=t};qe.prototype.setJitter=function(t){this.jitter=t};class _t extends ee{constructor(e,s){var i;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(s=e,e=void 0),s=s||{},s.path=s.path||"/socket.io",this.opts=s,ot(this,s),this.reconnection(s.reconnection!==!1),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor((i=s.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new qe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(s.timeout==null?2e4:s.timeout),this._readyState="closed",this.uri=e;const n=s.parser||yn;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=s.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var s;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(s=this.backoff)===null||s===void 0||s.setMin(e),this)}randomizationFactor(e){var s;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(s=this.backoff)===null||s===void 0||s.setJitter(e),this)}reconnectionDelayMax(e){var s;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(s=this.backoff)===null||s===void 0||s.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Ne(this.uri,this.opts);const s=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const n=de(s,"open",function(){i.onopen(),e&&e()}),o=de(s,"error",l=>{i.cleanup(),i._readyState="closed",this.emitReserved("error",l),e?e(l):i.maybeReconnectOnOpen()});if(this._timeout!==!1){const l=this._timeout;l===0&&n();const p=this.setTimeoutFn(()=>{n(),s.close(),s.emit("error",new Error("timeout"))},l);this.opts.autoUnref&&p.unref(),this.subs.push(function(){clearTimeout(p)})}return this.subs.push(n),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(de(e,"ping",this.onping.bind(this)),de(e,"data",this.ondata.bind(this)),de(e,"error",this.onerror.bind(this)),de(e,"close",this.onclose.bind(this)),de(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,s){let i=this.nsps[e];return i||(i=new Ms(this,e,s),this.nsps[e]=i),i}_destroy(e){const s=Object.keys(this.nsps);for(const i of s)if(this.nsps[i].active)return;this._close()}_packet(e){const s=this.encoder.encode(e);for(let i=0;i<s.length;i++)this.engine.write(s[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,s){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,s),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const s=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):e.onreconnect()}))},s);this.opts.autoUnref&&i.unref(),this.subs.push(function(){clearTimeout(i)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Fe={};function lt(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const s=ln(t,e.path||"/socket.io"),i=s.source,n=s.id,o=s.path,l=Fe[n]&&o in Fe[n].nsps,p=e.forceNew||e["force new connection"]||e.multiplex===!1||l;let h;return p?h=new _t(i,e):(Fe[n]||(Fe[n]=new _t(i,e)),h=Fe[n]),s.query&&!e.query&&(e.query=s.queryKey),h.socket(s.path,e)}Object.assign(lt,{Manager:_t,Socket:Ms,io:lt,connect:lt});const wn=We(JSON.parse(localStorage.access_token||"{}")),kn=We(JSON.parse(localStorage.refresh_token||"{}"));wn.subscribe(t=>{t!==""&&(localStorage.access_token=JSON.stringify(t))});kn.subscribe(t=>{t!==""&&(localStorage.refresh_token=JSON.stringify(t))});function ps(t,{delay:e=0,duration:s=400,easing:i=js}={}){const n=+getComputedStyle(t).opacity;return{delay:e,duration:s,easing:i,css:o=>`opacity: ${o*n}`}}function En(t){let e,s,i;return{c(){e=E("div"),s=E("a"),i=q("Fazer login com a Twitch."),this.h()},l(n){e=C(n,"DIV",{class:!0});var o=O(e);s=C(o,"A",{class:!0,href:!0});var l=O(s);i=z(l,"Fazer login com a Twitch."),l.forEach(y),o.forEach(y),this.h()},h(){A(s,"class","text-2xl hover:underline text-blue-600"),A(s,"href","https://id.twitch.tv/oauth2/authorize?response_type=code&client_id=u34qlogqginndqmxdtjks02ioj048a&redirect_uri=http://localhost:3000/authorize&scope=channel:read:redemptions&state=c3ab8aa609ea11e793ae92361f002671"),A(e,"class","flex h-screen items-center")},m(n,o){Y(n,e,o),u(e,s),u(s,i)},p:ve,i:ve,o:ve,d(n){n&&y(e)}}}function Cn(t){let e,s,i,n,o,l,p,h,g,c,_,d,w,r,a,f,T,b,m,v,D,x,I,F,P,L;function $(S){t[3](S)}let M={};t[0]!==void 0&&(M.speak=t[0]),e=new Ri({props:M}),Hs.push(()=>Js(e,"speak",$));let k=!t[2].username&&ms(t),N=Tn();return I=new yi({props:{speak:t[0]}}),{c(){Mt(e.$$.fragment),i=H(),n=E("div"),k&&k.c(),o=H(),l=E("div"),p=E("span"),h=q("Mensagens por minuto (padr\xE3o):"),g=H(),c=E("input"),_=H(),d=E("div"),w=E("span"),r=q("Mensagens por hora (padr\xE3o):"),a=H(),f=E("input"),T=H(),b=E("div"),m=E("h1"),v=q("Lista de comandos"),D=H(),N&&N.c(),x=H(),Mt(I.$$.fragment),this.h()},l(S){Ut(e.$$.fragment,S),i=J(S),n=C(S,"DIV",{class:!0});var U=O(n);k&&k.l(U),o=J(U),l=C(U,"DIV",{class:!0});var B=O(l);p=C(B,"SPAN",{});var G=O(p);h=z(G,"Mensagens por minuto (padr\xE3o):"),G.forEach(y),g=J(B),c=C(B,"INPUT",{type:!0,class:!0}),B.forEach(y),_=J(U),d=C(U,"DIV",{class:!0});var ne=O(d);w=C(ne,"SPAN",{});var oe=O(w);r=z(oe,"Mensagens por hora (padr\xE3o):"),oe.forEach(y),a=J(ne),f=C(ne,"INPUT",{type:!0,class:!0}),ne.forEach(y),U.forEach(y),T=J(S),b=C(S,"DIV",{class:!0});var le=O(b);m=C(le,"H1",{class:!0});var Z=O(m);v=z(Z,"Lista de comandos"),Z.forEach(y),D=J(le),N&&N.l(le),le.forEach(y),x=J(S),Ut(I.$$.fragment,S),this.h()},h(){A(c,"type","number"),A(c,"class","border-blue-500 border-2 rounded w-16"),A(l,"class","my-2"),A(f,"type","number"),A(f,"class","border-blue-500 border-2 rounded w-16"),A(d,"class","my-2"),A(n,"class","m-4"),A(m,"class","text-center font-bold"),A(b,"class","m-2 rounded-md bg-yellow-500 m-2 border-8 border-yellow-500 w-fit")},m(S,U){Vt(e,S,U),Y(S,i,U),Y(S,n,U),k&&k.m(n,null),u(n,o),u(n,l),u(l,p),u(p,h),u(l,g),u(l,c),ue(c,t[2].minuteLimit),u(n,_),u(n,d),u(d,w),u(w,r),u(d,a),u(d,f),ue(f,t[2].hourLimit),Y(S,T,U),Y(S,b,U),u(b,m),u(m,v),u(b,D),N&&N.m(b,null),Y(S,x,U),Vt(I,S,U),F=!0,P||(L=[ae(c,"input",t[5]),ae(f,"input",t[6]),ae(b,"mouseenter",t[7]),ae(b,"mouseleave",t[8])],P=!0)},p(S,U){const B={};!s&&U&1&&(s=!0,B.speak=S[0],Ws(()=>s=!1)),e.$set(B),S[2].username?k&&(k.d(1),k=null):k?k.p(S,U):(k=ms(S),k.c(),k.m(n,o)),U&4&&ye(c.value)!==S[2].minuteLimit&&ue(c,S[2].minuteLimit),U&4&&ye(f.value)!==S[2].hourLimit&&ue(f,S[2].hourLimit);const G={};U&1&&(G.speak=S[0]),I.$set(G)},i(S){F||(et(e.$$.fragment,S),et(N),et(I.$$.fragment,S),F=!0)},o(S){tt(e.$$.fragment,S),tt(N),tt(I.$$.fragment,S),F=!1},d(S){qt(e,S),S&&y(i),S&&y(n),k&&k.d(),S&&y(T),S&&y(b),N&&N.d(),S&&y(x),qt(I,S),P=!1,wt(L)}}}function ms(t){let e,s,i,n,o,l,p;return{c(){e=E("div"),s=E("span"),i=q("Canal:"),n=H(),o=E("input"),this.h()},l(h){e=C(h,"DIV",{});var g=O(e);s=C(g,"SPAN",{});var c=O(s);i=z(c,"Canal:"),c.forEach(y),n=J(g),o=C(g,"INPUT",{type:!0,class:!0}),g.forEach(y),this.h()},h(){A(o,"type","text"),A(o,"class","border-blue-500 border-2 rounded w-32")},m(h,g){Y(h,e,g),u(e,s),u(s,i),u(e,n),u(e,o),ue(o,t[2].channel),l||(p=ae(o,"input",t[4]),l=!0)},p(h,g){g&4&&o.value!==h[2].channel&&ue(o,h[2].channel)},d(h){h&&y(e),l=!1,p()}}}function Tn(t){let e,s,i,n,o,l,p,h,g,c,_,d,w,r,a,f,T,b,m,v,D,x,I,F,P,L,$,M,k,N,S,U,B,G,ne,oe,le;return{c(){e=E("div"),s=E("p"),i=E("span"),n=q("!voz"),o=q(" [mensagem]"),l=H(),p=E("p"),h=E("span"),g=q("!voz_ban"),c=q(" [usuario]"),_=H(),d=E("p"),w=E("span"),r=q("!voz_unban"),a=q(" [usuario]"),f=H(),T=E("p"),b=E("span"),m=q("!voz_timeout"),v=q(" [usuario] [dura\xE7\xE3o em minutos]"),D=H(),x=E("p"),I=E("span"),F=q("!voz_limite_minuto"),P=q(" [usuario] [limite de mensagens por minuto]"),L=H(),$=E("p"),M=E("span"),k=q("!voz_limite_hora"),N=q(" [usuario] [limite de mensagens por hora]"),S=H(),U=E("p"),B=E("span"),G=q("!voz_limite"),ne=q(" [usuario] [limite de mensagens por minuto e por hora  ]"),this.h()},l(Z){e=C(Z,"DIV",{});var X=O(e);s=C(X,"P",{});var pe=O(s);i=C(pe,"SPAN",{class:!0});var Ee=O(i);n=z(Ee,"!voz"),Ee.forEach(y),o=z(pe," [mensagem]"),pe.forEach(y),l=J(X),p=C(X,"P",{});var me=O(p);h=C(me,"SPAN",{class:!0});var te=O(h);g=z(te,"!voz_ban"),te.forEach(y),c=z(me," [usuario]"),me.forEach(y),_=J(X),d=C(X,"P",{});var ge=O(d);w=C(ge,"SPAN",{class:!0});var se=O(w);r=z(se,"!voz_unban"),se.forEach(y),a=z(ge," [usuario]"),ge.forEach(y),f=J(X),T=C(X,"P",{});var j=O(T);b=C(j,"SPAN",{class:!0});var re=O(b);m=z(re,"!voz_timeout"),re.forEach(y),v=z(j," [usuario] [dura\xE7\xE3o em minutos]"),j.forEach(y),D=J(X),x=C(X,"P",{});var K=O(x);I=C(K,"SPAN",{class:!0});var _e=O(I);F=z(_e,"!voz_limite_minuto"),_e.forEach(y),P=z(K," [usuario] [limite de mensagens por minuto]"),K.forEach(y),L=J(X),$=C(X,"P",{});var Ie=O($);M=C(Ie,"SPAN",{class:!0});var Ae=O(M);k=z(Ae,"!voz_limite_hora"),Ae.forEach(y),N=z(Ie," [usuario] [limite de mensagens por hora]"),Ie.forEach(y),S=J(X),U=C(X,"P",{});var Pe=O(U);B=C(Pe,"SPAN",{class:!0});var ze=O(B);G=z(ze,"!voz_limite"),ze.forEach(y),ne=z(Pe," [usuario] [limite de mensagens por minuto e por hora  ]"),Pe.forEach(y),X.forEach(y),this.h()},h(){A(i,"class","font-semibold"),A(h,"class","font-semibold"),A(w,"class","font-semibold"),A(b,"class","font-semibold"),A(I,"class","font-semibold"),A(M,"class","font-semibold"),A(B,"class","font-semibold")},m(Z,X){Y(Z,e,X),u(e,s),u(s,i),u(i,n),u(s,o),u(e,l),u(e,p),u(p,h),u(h,g),u(p,c),u(e,_),u(e,d),u(d,w),u(w,r),u(d,a),u(e,f),u(e,T),u(T,b),u(b,m),u(T,v),u(e,D),u(e,x),u(x,I),u(I,F),u(x,P),u(e,L),u(e,$),u($,M),u(M,k),u($,N),u(e,S),u(e,U),u(U,B),u(B,G),u(U,ne),le=!0},i(Z){le||(bs(()=>{oe||(oe=zt(e,ps,{duration:500},!0)),oe.run(1)}),le=!0)},o(Z){oe||(oe=zt(e,ps,{duration:500},!1)),oe.run(0),le=!1},d(Z){Z&&y(e),Z&&oe&&oe.end()}}}function Sn(t){let e,s,i,n;const o=[Cn,En],l=[];function p(h,g){return 0}return e=p(),s=l[e]=o[e](t),{c(){s.c(),i=Dt()},l(h){s.l(h),i=Dt()},m(h,g){l[e].m(h,g),Y(h,i,g),n=!0},p(h,[g]){s.p(h,g)},i(h){n||(et(s),n=!0)},o(h){tt(s),n=!1},d(h){l[e].d(h),h&&y(i)}}}function Nn(t,e,s){let i;He(t,De,d=>s(2,i=d));let n,o=!1;function l(d){n=d,s(0,n)}function p(){i.channel=this.value,De.set(i)}function h(){i.minuteLimit=ye(this.value),De.set(i)}function g(){i.hourLimit=ye(this.value),De.set(i)}return[n,o,i,l,p,h,g,()=>{s(1,o=!0)},()=>{s(1,o=!1)}]}class Rn extends bt{constructor(e){super(),yt(this,e,Nn,Sn,vt,{})}}export{Rn as default};
